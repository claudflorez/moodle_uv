define(["jquery","block_ases/bootstrap","block_ases/jquery.dataTables","block_ases/sweetalert","block_ases/dphpforms_form_renderer"],function(a,e,t,s,n){return{init:function(){var e=this,t=e.get_id_instance();e.load_not_assigned_students(t),a("#send_form_btn").on("click",function(){e.create_assign_table(t)}),a(document).on("click","#tableAssign tbody tr td #student_assign",function(){var s=a("#tableAssign").DataTable().row(a(this).parents("tr")).data(),n=t,r=s.username,i=a(this).closest("tr").find("#monitors").val(),o=a(this).closest("tr").find("#practicants").val(),c=!0,l="";"-1"==i&&(c=!1,l+="* Debe elegir monitor a asignar \n"),"-1"==o&&(c=!1,l+="*Debe elegir practicantes a asignar"),c?a.ajax({type:"POST",data:{type:"assign_student",monitor:i,practicant:o,instance:n,student:r},url:"../managers/ases_report/asesreport.php",success:function(a){alert(a),e.load_not_assigned_students(t)},dataType:"text",cache:"false",error:function(a){alert("Debe seleccionar solo un practicante y monitor a la vez"),console.log("Error al asignar estudiantes"+a)}}):alert(l)}),a(document).on("click","#tableAssign tbody tr td",function(){var e=a("#tableAssign").DataTable();e.cell(this).index().column<=2&&(a("#formulario").each(function(){this.reset}),location.href="student_profile.php"+location.search+"&student_code="+e.cell(e.row(this).index(),0).data())}),a(document).on("change","#tableAssign tbody tr td select#practicants",function(){var e=a(this).val(),s=t;a.ajax({type:"POST",data:{user:e,instance:s,source:"list_monitors"},url:"../managers/ases_report/asesreport.php",success:function(e){a("select#monitors").find("option").remove().end(),a("select#monitors").append(e)},dataType:"json",cache:"false",error:function(a){alert("Error al cargar monitores con practicante seleccionado")}})})},create_assign_table:function(e){var t=a("#form_general_report").serializeArray();t.push({name:"instance_id",value:e}),a("#not_assigned_students").html('<img class="icon-loading" src="../icon/loading.gif"/>'),a.ajax({type:"POST",data:t,url:"../managers/ases_report/load_not_assigned_students.php",success:function(e){a("#not_assigned_students").html(""),a("#not_assigned_students").fadeIn(1e3).append('<table id="tableAssign" class="display" cellspacing="0" width="100%"><thead> </thead></table>');a("#tableAssign").DataTable(e)},dataType:"json",cache:"false",error:function(a){alert("Error al cargar estudiantes no asignados")}})},load_not_assigned_students:function(e){var t=a("#form_general_report").serializeArray();t.push({name:"instance_id",value:e}),a("#not_assigned_students").html('<img class="icon-loading" src="../icon/loading.gif"/>'),a.ajax({type:"POST",data:t,url:"../managers/ases_report/load_not_assigned_students.php",success:function(e){a("#not_assigned_students").html(""),a("#not_assigned_students").fadeIn(1e3).append('<table id="tableAssign" class="display" cellspacing="0" width="100%"><thead> </thead></table>');a("#tableAssign").DataTable(e)},dataType:"json",cache:"false",error:function(a){alert("Error al cargar estudiantes no asignados")}})},get_id_instance:function(){var a=location.search.split("&");for(var e in a){if(a[e].indexOf("instanceid")>=0)return a[e].split("=")[1]}return 0}}});