'use strict';define(['jquery','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2'],function(a){return{init:function init(){function g(){return a('#dphpforms_ases_student_code').attr('data-info')}function h(){return a('#dphpforms_block_instance').attr('data-info')}function j(){var q=l('.seg_geo_nivel_riesgo'),r=a('.seg_geo_observaciones').find('textarea').val();if('3'==q){var s={'function':'send_email_dphpforms',student_code:g(),risks:[{name:'Geogr\xE1fico',risk_lvl:q,observation:r}],date:a('.fecha').find('input').val(),url:window.location.href};console.log(JSON.stringify(s)),a.ajax({type:'POST',data:JSON.stringify(s),url:'../managers/pilos_tracking/send_risk_email.php',success:function success(t){console.log(t)},dataType:'text',cache:'false',error:function error(t){console.log(t)}})}}function k(){var q=l('.puntuacion_riesgo_individual'),r=a('.comentarios_individual').find('textarea').val();var s=l('.puntuacion_riesgo_familiar'),t=a('.comentarios_familiar').find('textarea').val(),u=l('.puntuacion_riesgo_academico'),v=a('.comentarios_academico').find('textarea').val(),w=l('.puntuacion_riesgo_economico'),y=a('.comentarios_economico').find('textarea').val(),A=l('.puntuacion_vida_uni'),B=a('.comentarios_vida_uni').find('textarea').val();if('3'==q||'3'==s||'3'==u||'3'==w||'3'==A){var C={'function':'send_email_dphpforms',student_code:g(),risks:[{name:'Individual',risk_lvl:q,observation:r},{name:'Familiar',risk_lvl:s,observation:t},{name:'Acad\xE9mico',risk_lvl:u,observation:v},{name:'Econ\xF3mico',risk_lvl:w,observation:y},{name:'Vida Universitaria',risk_lvl:A,observation:B}],date:a('.fecha').find('input').val(),url:window.location.href};console.log(JSON.stringify(C)),a.ajax({type:'POST',data:JSON.stringify(C),url:'../managers/pilos_tracking/send_risk_email.php',success:function success(D){console.log(D)},dataType:'text',cache:'false',error:function error(D){console.log(D)}})}}function l(p){var q=0;return a(p).find('.opcionesRadio').find('div').each(function(){a(this).find('label').find('input').is(':checked')&&(q=a(this).find('label').find('input').val())}),q}function m(p,q){if('primer_acercamiento'==p&&'insert'==q);else if('primer_acercamiento'==p&&'update'==q);else if('inasistencia'==p&&'insert'==q);else if('inasistencia'==p&&'update'==q){var r=a('.dphpforms-record .btn-dphpforms-univalle').length;1==r?a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-a('.dphpforms-record .btn-dphpforms-close').outerWidth()/2+'px'}):2==r?a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72+'px'}):3==r&&a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72-30+'px'})}else if('seguimiento_pares'==p&&'insert'==q);else if('seguimiento_pares'==p&&'update'==q){var s=a('.dphpforms-record').find('.revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),t=a('.dphpforms-record').find('.revisado_practicante').find('.checkbox').find('input[type=checkbox]').prop('checked'),u=a('#dphpforms_role_support').attr('data-info');s&&'sistemas'!=u&&(a('.btn-dphpforms-delete-record').remove(),a('.btn-dphpforms-update').remove()),'dir_socioeducativo'==u&&(a('.btn-dphpforms-delete-record').remove(),a('.btn-dphpforms-update').remove());var r=a('.dphpforms-record .btn-dphpforms-univalle').length;1==r?a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-a('.dphpforms-record .btn-dphpforms-close').outerWidth()/2+'px'}):2==r?a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72+'px'}):3==r&&a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72-30+'px'})}else if('seguimiento_geografico_'==p&&'insert'==q)a('.seg_geo_origen').find('input').prop('disabled',!1);else if('seguimiento_geografico_'==p&&'update'==q);else if('seguimiento_grupal_'==p&&'insert'==q){var v=a('modal_v2_edit_groupal_tracking').find('input:checked').length,w='',y='';a('#modal_v2_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(''),a('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(''),a('#modal_v2_edit_groupal_tracking').find('input:checked').each(function(){var B=a(this).parent().parent().find('>:first-child').text(),C=B.split('-');w+=C[0]+','}),a('#modal_v2_groupal_tracking').find('input:checked').each(function(){var B=a(this).parent().parent().find('>:first-child').text(),C=B.split('-');y+=C[0]+','}),a('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(w.slice(0,-1)),a('#modal_v2_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(y.slice(0,-1))}else if('seguimiento_grupal_'==p&&'update'==q);}function n(p){students_code=p.split(','),console.log('.id_estudiante :'+students_code);var q=[];a('#list_students_attendance_1 > tbody  > tr').each(function(){var s=a(this).children('td').first().html().split('-');q.push(s[0])}),console.log('lista total de id_estudiantes :'+q),console.log('lista de estudiantes seleccin : '+students_code),a.each(students_code,function(r,s){var t=q.indexOf(s);if(-1!=t){var u=a('#list_students_attendance_1 tbody>tr:eq(\''+t+'\')'),v=u.find('td').eq(3).children('input');a('input[type=checkbox][value=\''+v.val()+'\']').prop('checked',!0)}})}function o(p,q){a('.div').removeClass('regla_incumplida'),a.get('../managers/dphpforms/dphpforms_forms_core.php?form_id=&record_id='+q,function(r){a('#body_editor').html(''),a('#body_editor').append(r);var s=a('#list_grupal_seg_consult').clone().prop('id','list_grupal_seg_consult_1');a('#modal_v2_edit_groupal_tracking').find('form').find('h1').after(s),a('#list_grupal_seg_consult_1 > #list_students_attendance').prop('id','list_students_attendance_1'),a('#list_grupal_seg_consult_1  input[type=checkbox]').prop('checked',!1);var t=a('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input');t.val()!=void 0&&n(t.val()),a('#permissions_informationr').html('');var u=a('.dphpforms-record').find('.revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),v=a('.dphpforms-record').find('.revisado_practicante').find('.checkbox').find('input[type=checkbox]').prop('checked');(u||v)&&a('.dphpforms-record').find('.btn-dphpforms-delete-record').remove();for(var w=JSON.parse(a('#permissions_information').text()),y=0;y<w.behaviors_permissions.length;y++){for(var D,A=w.behaviors_permissions[y].behaviors[0],B=A.behaviors_accessibility,C=0;C<B.length;C++)D=B[C].disabled,'true'==D?D=!0:'false'==D&&(D=!1),a('.dphpforms-record').find('#'+B[C].id).prop('disabled',D),a('.dphpforms-record').find('.'+B[C]['class']).prop('disabled',D);for(var E=A.behaviors_fields_to_remove,C=0;C<E.length;C++)a('.dphpforms-record').find('#'+E[C].id).remove(),a('.dphpforms-record').find('.'+E[C]['class']).remove();for(var F=A.limpiar_to_eliminate,C=0;C<F.length;C++)a('.dphpforms-record').find('.'+F[C]['class']+'.limpiar ').remove()}a('#permissions_informationr').html('');var G=r.indexOf('primer_acercamiento_');-1!=G&&m('primer_acercamiento','update');var H=r.indexOf('seguimiento_de_pares_');-1!=H&&m('seguimiento_pares','update');var I=r.indexOf('inasistencia');-1!=I&&m('inasistencia','update')})}a(document).on('click','.btn-dphpforms-close',function(){a(this).closest('div[class="mymodal"]').fadeOut(300)}),a('.outside').click(function(){var p=a(this);swal({title:'Confirmaci\xF3n de salida',text:'',type:'warning',showCancelButton:!0,confirmButtonText:'Salir'},function(q){q&&(a(p).parent('.mymodal').fadeOut(300),console.log(a(this).parent('.mymodal')))})}),a(document).ready(function(){a('.seg_geo_origen').find('input').prop('disabled',!0)}),a(document).on('change',a('.seg_geo_vive_zona_riesgo').find('label').find('input'),function(){a('.seg_geo_vive_zona_riesgo').find('label').find('input').prop('checked')?a('.seg_geo_origen').find('input').prop('disabled',!1):(a('.seg_geo_origen').find('input').prop('disabled',!0),a('.seg_geo_origen').find('input').prop('checked',!1))}),a('.seg_geo_vive_zona_riesgo').find('label').find('input').change(function(){a('.seg_geo_vive_zona_riesgo').find('label').find('input').prop('checked')?a('.seg_geo_origen').find('input').prop('disabled',!1):(a('.seg_geo_origen').find('input').prop('disabled',!0),a('.seg_geo_origen').find('input').prop('checked',!1))}),a('#button_actualizar_primer_acercamiento').click(function(){a('div').removeClass('regla_incumplida'),a.get('../managers/dphpforms/dphpforms_forms_core.php?form_id=primer_acercamiento&record_id='+a(this).attr('data-record-id'),function(p){a('#primer_acercamiento_form').html(''),a('#primer_acercamiento_form').append(p),a('#modal_primer_acercamiento').fadeIn(300);var q=a('#modal_primer_acercamiento').find('.pa_id_creado_por').find('input').val();a.get('../managers/user_management/api_user.php?function=get_user_information&arg='+q,function(r){var s=r.firstname+' '+r.lastname;a('#modal_primer_acercamiento').find('h1').after('<hr style="border-color:#444;"><h3>Registrado por: <strong>'+s+'</strong></h3>');var t=a('.dphpforms-record .btn-dphpforms-univalle').length;2==t?a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72+'px'}):3==t&&a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72-30+'px'})})})}),a('#button_update_geographic_track').click(function(){a('div').removeClass('regla_incumplida'),a.get('../managers/dphpforms/dphpforms_forms_core.php?form_id=seguimiento_geografico&record_id='+a(this).attr('data-record-id'),function(p){a('#seguimiento_geografico_form').html(''),a('#seguimiento_geografico_form').append(p),a('#modal_seguimiento_geografico').fadeIn(300),a('.seg_geo_vive_zona_riesgo').find('label').find('input').prop('checked')?a('.seg_geo_origen').find('input').prop('disabled',!1):(a('.seg_geo_origen').find('input').prop('disabled',!0),a('.seg_geo_origen').find('input').prop('checked',!1));var q=a('.dphpforms-record .btn-dphpforms-univalle').length;2==q&&a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72+'px'}),3==q&&a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72-30+'px'})})});a('.btn.btn-danger.btn-univalle.btn-card').click(function(){var p=a(this).attr('data-container'),q=a('#'+p).height();if(0==q)a(this).find('span').removeClass('glyphicon-chevron-left'),a(this).find('span').addClass('glyphicon-chevron-down');else{for(;0>q;)q=a('#'+p).height();a(this).find('span').removeClass('glyphicon-chevron-down'),a(this).find('span').addClass('glyphicon-chevron-left')}}),a('#button_add_v2_track').on('click',function(){a('div').removeClass('regla_incumplida'),a('#modal_v2_peer_tracking').fadeIn(300),a('.id_estudiante').find('input').val(g());var p=a('#current_user_id').val();a('.id_creado_por').find('input').val(p),a('.id_instancia').find('input').val(h()),a('.id_monitor').find('input').val(a('#dphpforms_monitor_id').data('info')),a('.id_practicante').find('input').val(a('#dphpforms_practicing_id').data('info')),a('.id_profesional').find('input').val(a('#dphpforms_professional_id').data('info')),a('.dphpforms-response .btn-dphpforms-sendform').css({'margin-left':a('.dphpforms-response').width()/2-a('.dphpforms-response .btn-dphpforms-univalle').outerWidth()/2-a('.dphpforms-response .btn-dphpforms-close').outerWidth()/2+'px'})}),a('.btn-inasistencia').on('click',function(){var p=a(this).attr('data-info');if('inasistencia'==p){a('#modal_inasistencia').fadeOut(300),a('#modal_v2_peer_tracking').fadeIn(300),a('.id_estudiante').find('input').val(g());var q=a('#current_user_id').val();a('.id_creado_por').find('input').val(q),a('.id_instancia').find('input').val(h()),a('.id_monitor').find('input').val(a('#dphpforms_monitor_id').data('info')),a('.id_practicante').find('input').val(a('#dphpforms_practicing_id').data('info')),a('.id_profesional').find('input').val(a('#dphpforms_professional_id').data('info')),a('.dphpforms-response .btn-dphpforms-sendform').css({'margin-left':a('.dphpforms-response').width()/2-a('.dphpforms-response .btn-dphpforms-univalle').outerWidth()/2-a('.dphpforms-response .btn-dphpforms-close').outerWidth()/2+'px'})}else{a('#modal_v2_peer_tracking').fadeOut(300),a('#modal_inasistencia').fadeIn(300),a('.in_id_estudiante').find('input').val(g());var q=a('#current_user_id').val();a('.in_id_creado_por').find('input').val(q),a('.in_id_instancia').find('input').val(h()),a('.in_id_monitor').find('input').val(a('#dphpforms_monitor_id').data('info')),a('.in_id_practicante').find('input').val(a('#dphpforms_practicing_id').data('info')),a('.in_id_profesional').find('input').val(a('#dphpforms_professional_id').data('info'))}}),a('#button_add_groupal_track').on('click',function(){a('div').removeClass('regla_incumplida'),a('#modal_v2_groupal_tracking').fadeIn(300);var p=a('#current_user_id').val();a('.id_creado_por').find('input').val(p),a('.id_estudiante').find('input').val('-'),a('#list_grupal_seg_consult  input[type=checkbox]').prop('checked',!1)}),a('#button_primer_acercamiento').on('click',function(){a('div').removeClass('regla_incumplida'),a('#modal_primer_acercamiento').fadeIn(300),a('.primer_acerca_id_estudiante_field').find('input').val(g());var p=a('#current_user_id').val();a('.primer_acerca_id_creado_por_field').find('input').val(p),a('#primer_acercamiento_form').find('.dphpforms-response .btn-dphpforms-sendform').css({'margin-left':a('#primer_acercamiento_form').find('.dphpforms-response').width()/2-a('#primer_acercamiento_form').find('.dphpforms-response .btn-dphpforms-univalle').outerWidth()/2-a('#primer_acercamiento_form').find('.btn-dphpforms-close').outerWidth()/2+'px'})}),a('#button_add_geographic_track').on('click',function(){a('div').removeClass('regla_incumplida'),a('#modal_seguimiento_geografico').fadeIn(300),a('.seg_geo_id_estudiante').find('input').val(g());var p=a('#current_user_id').val();a('.seg_geo_id_creado_por').find('input').val(p),a('.seg_geo_vive_zona_riesgo').find('label').find('input').prop('checked')?a('.seg_geo_origen').find('input').prop('disabled',!1):(a('.seg_geo_origen').find('input').prop('disabled',!0),a('.seg_geo_origen').find('input').prop('checked',!1)),a('#seguimiento_geografico_form').find('.dphpforms-response .btn-dphpforms-sendform').css({'margin-left':a('#seguimiento_geografico_form').find('.dphpforms-response').width()/2-a('#seguimiento_geografico_form').find('.dphpforms-response .btn-dphpforms-univalle').outerWidth()/2-a('#seguimiento_geografico_form').find('.btn-dphpforms-close').outerWidth()/2+'px'})}),a('.mymodal-close').click(function(){a(this).parent().parent().parent().parent().fadeOut(300),a('#list_grupal_seg_consult_1').remove()}),a('.dphpforms-peer-record').on('click',function(){var p=a(this).attr('data-record-id');o('seguimiento_pares',p),a('#modal_v2_edit_peer_tracking').fadeIn(300)}),a('.dphpforms-groupal-record').on('click',function(){var p=a(this).attr('data-record-id');o('seguimiento_grupal',p),a('#modal_v2_edit_groupal_tracking').fadeIn(300)}),a('.limpiar').click(function(){a(this).parent().find('.opcionesRadio').find('div').each(function(){a(this).find('label').find('input').prop('checked',!1)})}),a(document).on('click','.limpiar',function(){a(this).parent().find('.opcionesRadio').find('div').each(function(){a(this).find('label').find('input').prop('checked',!1)})}),a(document).on('submit','.dphpforms',function(p){p.preventDefault();var q=a(this).attr('id').indexOf('seguimiento_geografico_'),r=a(this).attr('id').indexOf('seguimiento_grupal_');-1!=q&&m('seguimiento_geografico_','insert'),-1!=r&&(a('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(''),m('seguimiento_grupal_','insert')),a('.seg_geo_origen').find('input').prop('disabled',!1),a(':disabled').prop('disabled',!1);var s=new FormData(this),t=a(this),u=t.attr('action');'procesador.php'==t.attr('action')&&(u='../managers/dphpforms/procesador.php'),a(t).find('button').prop('disabled',!0),a(t).find('a').attr('disabled',!0),console.log(t),a.ajax({type:'POST',url:u,data:s,cache:!1,contentType:!1,processData:!1,success:function success(v){console.log(v);var w=JSON.parse(v);if(0==w.status){a.get('../managers/pilos_tracking/api_pilos_tracking.php?function=update_last_user_risk&arg='+g()+'&rid=-1',function(C){console.log(C)});var y='';'Stored'==w.message?y='Almacenado':'Updated'==w.message&&(y='Actualizado'),k(),j(),swal({title:'Informaci\xF3n',text:y,type:'success'},function(){'Updated'==w.message?(a('#dphpforms-peer-record-'+a('#dphpforms_record_id').val()).stop().animate({backgroundColor:'rgb(175, 255, 173)'},400).animate({backgroundColor:'#f5f5f5'},4e3),location.reload()):(a('.dphpforms-response').trigger('reset'),location.reload())}),a('#modal_v2_edit_peer_tracking').fadeOut(300),a('#modal_v2_peer_tracking').fadeOut(300),a('#modal_primer_acercamiento').fadeOut(300),a('#modal_seguimiento_geografico').fadeOut(300),a(t).find('button').prop('disabled',!1),a(t).find('a').attr('disabled',!1)}else if(-2==w.status){a(t).find('button').prop('disabled',!1),a(t).find('a').attr('disabled',!1);var y='';if('Without changes'==w.message)y='No hay cambios que registrar',a('#modal_v2_edit_peer_tracking').fadeOut(300),a('#modal_v2_peer_tracking').fadeOut(300),a('#modal_primer_acercamiento').fadeOut(300),a('#modal_seguimiento_geografico').fadeOut(300);else if('Unfulfilled rules'==w.message){var A=w.data.id_form_pregunta_a,B=w.data.id_form_pregunta_b;a('div').removeClass('regla_incumplida'),a('.div-'+A).addClass('regla_incumplida'),a('.div-'+B).addClass('regla_incumplida'),y='Ups, revise los campos que se acaban de colorear en rojo.'}swal('Alerta',y,'warning')}else-1==w.status&&(console.log(v),swal('ERROR!','Oops!, informe de este error','error'))},error:function error(v){console.log(v),swal('Error!','Oops!, informe de este error','error'),a(t).find('button').prop('disabled',!1),a(t).find('a').attr('disabled',!1)}})}),a(document).on('click','.btn-dphpforms-delete-record',function(){swal({title:'Confirmaci\xF3n',text:'Est\xE1 eliminando este registro, \xBFdesea continuar?',type:'warning',showCancelButton:!0,confirmButtonText:'S\xED, Eliminar!'},function(p){if(p){var q=a('.btn-dphpforms-delete-record').attr('data-record-id');a.get('../managers/dphpforms/dphpforms_delete_record.php?record_id='+q,function(r){var s=r;0==s.status?(console.log(s),a.get('../managers/pilos_tracking/api_pilos_tracking.php?function=update_last_user_risk&arg='+g()+'&rid='+q,function(t){console.log(t)}),setTimeout(function(){swal({title:'Informaci\xF3n',text:'Eliminado',type:'success'},function(){location.reload()})},500)):-1==s.status&&setTimeout(function(){swal('Error!',s.message,'error')},500)})}})})}}});