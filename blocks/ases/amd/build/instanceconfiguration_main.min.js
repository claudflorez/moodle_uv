define(["jquery","block_ases/bootstrap","block_ases/jquery.dataTables","block_ases/sweetalert"],function(a,b,c,d){return{init:function(){var b=this,c=b.get_id_instance();b.load_cohorts_assigned();a("#input_idnumber").val(),a("#input_description").val();a("span.unassigned_cohort").on("click",{object_function:b},b.unassign_cohort),a("#button_assign_cohort").on("click",{object_function:b},b.assign_cohort_instance),a("#button_update_instance").on("click",function(){var d=a("#input_idnumber").val(),e=a("#input_description").val();b.update_info_instance(c,d,e)})},get_cohorts_without_assignment:function(b){if(void 0==b)var b=this.get_id_instance();a.ajax({type:"POST",data:{"function":"load_cohorts_without_assignment",instance:b},url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(b){if(0==b.status)d("Error",b.msg,"error");else if(1==b.status){var c="",e=b.msg;0==e.length?c+="<option>No hay cohortes disponibles para asignar</option>":a.each(e,function(a){c+="<option value='"+e[a].id+"'>",c+=e[a].idnumber+" "+e[a].name+"</option>"}),a("#select_cohorts").html(c)}else{var f="Error al cargar las cohortes no asignadas. Por favor recargue la página.";f+="Si el problema persiste contacte al área de sistemas.",d("Error",f,"error")}},dataType:"json",cache:!1,async:!1,error:function(){d("Error","Error al cargar las cohortes sin asignación","error")}})},load_cohorts_assigned:function(b){if(void 0==b)var b=this.get_id_instance();a.ajax({type:"POST",data:{"function":"load_cohorts",instance:b},url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(b){if(0==b.status)a("#div_cohorts_table").html("<center><span>La instancia no tiene cohortes asignadas</span></center>");else{var c="";c+="<h4>Cohortes asignadas a la instancia</h4><hr/>",c+="<table id='cohorts_table' class='col-sm-12' style='width:100%'></table>",a("#div_cohorts_table").html(c),a("#cohorts_table").DataTable(b.msg)}},dataType:"json",cache:!1,async:!1,error:function(){d("Error","Error al cargar las cohortes asignadas","error")}})},unassign_cohort:function(b){var c=a(this).parent().siblings()[0].innerHTML,e=b.data.object_function.get_id_instance();a.ajax({type:"POST",data:{"function":"unassign_cohort",instance_id:e,idnumber_cohort:c},url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(a){1==a.status?d("Éxito",a.msg,"success"):d("Error",a.msg,"error")},error:function(a){d("Error","Error al conctarse con el servidor.","error")},dataType:"json",cache:!1,async:!1}),b.data.object_function.get_cohorts_without_assignment(),b.data.object_function.load_cohorts_assigned(),a("span.unassigned_cohort").on("click",{object_function:b.data.object_function},b.data.object_function.unassign_cohort)},get_id_instance:function(){var a=location.search.split("&");for(var b in a)if(a[b].indexOf("instanceid")>=0){var c=a[b].split("=");return c[1]}return 0},assign_cohort_instance:function(b){var c=a("#select_cohorts").val(),e=b.data.object_function.get_id_instance();a.ajax({type:"POST",data:{"function":"insert_cohort",cohort:c,instance:e},url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(c){if(0==c.status)var e="Error",f="error";else var e="Éxito",f="success";d(e,c.msg,f),b.data.object_function.get_cohorts_without_assignment(),b.data.object_function.load_cohorts_assigned(),a("span.unassigned_cohort").on("click",{object_function:b.data.object_function},b.data.object_function.unassign_cohort)},dataType:"json",cache:!1,async:!1,error:function(){d("Error","Error al comunicarse con el servidor.","error")}})},update_info_instance:function(b,c,e){data={"function":"update_info_instance",instance_id:b,idnumber:c,description:e},a.ajax({type:"POST",data:data,url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(a){a?d("Éxito",a.msg,"success"):d("Error",a.msg,"error")},dataType:"json",cache:!1,async:!1,error:function(){d("Error","Error al actualizar la instancia","error")}})}}});