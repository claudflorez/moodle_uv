define(["jquery","block_ases/bootstrap","block_ases/jquery.dataTables","block_ases/sweetalert","block_ases/select2"],function(a,b,c,d,e){return{init:function(){function b(){a("#functions").select2({placeholder:"Select a Program",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},width:"36%",dropdownAutoWidth:!0})}function c(){a("#profiles_user").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},width:"36%",dropdownAutoWidth:!0,placeholder:"Seleccionar perfil"})}function d(){var b=a("#nombre").val().trim(),c=a("#descripcion").val().trim(),d=a("#functions").val(),e="",f=!1;0==b.length&&(e="Nombre no puede ser nulo",f=!0),0==c.length&&(e+="<br>Descripcion no puede ser nulo",f=!0),0==d&&(e+="<br>Funcionalidad no puede ser nulo",f=!0),f?swal({title:"Error al crear Acción.",text:e,html:!0,type:"warning",confirmButtonColor:"#d51b23"}):a.ajax({type:"POST",data:{nombre:b,descripcion:c,id_funcionalidad:d},url:"../managers/ActionCreateAction.php",async:!1,success:function(b){a("#formAction")[0].reset(),swal({title:"",text:b,type:"info",showCancelButton:!1,showConfirmButton:!0},function(){location.reload()})}})}function e(){var b=a("#nombre_funcionalidad").val().trim(),c=a("#descripcion_funcionalidad").val().trim(),d="";0==b.length&&(d="Nombre no puede ser nulo"),0==c.length&&(d+="\nDescripcion no puede ser nulo"),0==b.length||0==c.length?swal({title:"Error al crear Funcionalidad.",text:d,html:!0,type:"warning",confirmButtonColor:"#d51b23"}):a.ajax({type:"POST",data:{nombre_funcionalidad:b,descripcion_funcionalidad:c},url:"../managers/ActionCreateAction.php",success:function(b){a("#formFuncion")[0].reset(),swal({title:"",text:b,type:"info",showCancelButton:!1,showConfirmButton:!0},function(){location.reload()})}})}function f(){var b=a("#nombre_perfil").val().trim(),c=a("#descripcion_perfil").val().trim(),d="";0==b.length&&(d="Nombre del perfil no puede ser nulo"),0==c.length&&(d+="<br>Descripcion del perfil no puede ser nulo"),0==b.length||0==c.length?swal({title:"Error al crear Funcionalidad.",text:d,html:!0,type:"warning",confirmButtonColor:"#d51b23"}):a.ajax({type:"POST",data:{nombre_perfil:b,descripcion_perfil:c},url:"../managers/ActionCreateAction.php",async:!1,success:function(b){a("#formPerfil")[0].reset(),swal({title:"",text:b,type:"info",showCancelButton:!1,showConfirmButton:!0})}})}function g(b){var c=a("#profiles_user").val(),d=[],e=(a("input[name='actions[]']:checked").each(function(){d.push(a(this).val())}),JSON.stringify(d));""==c?swal({title:"Error",text:"Seleccione el rol del usuario",type:"error",confirmButtonColor:"#d51b23"}):a.ajax({type:"POST",data:{profile:c,actions:e,"function":"assign_role",instance:b},url:"../managers/ActionCreateAction.php",async:!1,success:function(a){swal({title:"",text:a,type:"info",showCancelButton:!1,showConfirmButton:!0})}})}function h(b,c){a.ajax({type:"POST",data:{id:b,source:"delete_record",type:c},url:"../managers/permissions_management/permissions_report.php",success:function(a){swal({title:a.title,html:!0,text:a.text,type:a.type,confirmButtonColor:"#d51b23"}),l(),m(o)},dataType:"json",cache:"false",error:function(a){swal({title:"Error",text:"Error al eliminar registro",type:"error",confirmButtonColor:"#d51b23"})}})}function i(){a.ajax({type:"POST",url:"../managers/permissions_management/load_function.php",success:function(b){a("#div_functions").empty(),a("#div_functions").append('<table id="tableFunctions"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');a("#tableFunctions").DataTable(b);a("#div_functions #modify_function").css("cursor","pointer")},dataType:"json",cache:"false",error:function(a){swal({title:"Error al cargar Funcionalidades.",text:a,type:"error",confirmButtonColor:"#d51b23"})}})}function j(){a.ajax({type:"POST",url:"../managers/permissions_management/load_actions.php",success:function(b){a("#div_actions").empty(),a("#div_actions").append('<table id="tableActions"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');a("#tableActions").DataTable(b);a("#div_actions #delete_action").css("cursor","pointer")},dataType:"json",cache:"false",error:function(a){swal({title:"Error al cargar acciones.",text:a,type:"error",confirmButtonColor:"#d51b23"})}})}function k(){a.ajax({type:"POST",url:"../managers/permissions_management/load_profiles.php",success:function(b){a("#div_profiles").empty(),a("#div_profiles").append('<table id="tableProfiles"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');a("#tableProfiles").DataTable(b);a("#div_profiles #delete_profiles").css("cursor","pointer")},dataType:"json",cache:"false",error:function(a){swal({title:"Error al cargar roles.",text:a,type:"error",confirmButtonColor:"#d51b23"})}})}function l(){a.ajax({type:"POST",data:{source:"update_functionality_select"},url:"../managers/permissions_management/permissions_report.php",dataType:"json",cache:"false",success:function(b){a("#funct1").html(b[0]),a("#funct2").html(b[1])},error:function(a){swal({title:"Error al actualizar Funcionalidad.",text:a,type:"error",confirmButtonColor:"#d51b23"})}})}function m(b){a.ajax({type:"POST",data:{source:"update_general_table",instance:b},url:"../managers/permissions_management/permissions_report.php",dataType:"json",cache:"false",success:function(b){a("#lista_funcionalidades").html(b)},error:function(a){swal({title:"Error al actualizar la asignacion de roles y permisos.",text:a,type:"error",confirmButtonColor:"#d51b23"})}})}function n(){a.ajax({type:"POST",data:{source:"update_role_select"},url:"../managers/permissions_management/permissions_report.php",dataType:"json",cache:"false",success:function(b){a("#profiles_user").html(b),c()},error:function(a){swal({title:"Error al actualizar roles.",text:a,type:"error",confirmButtonColor:"#d51b23"})}})}c(),b();var o;a(document).ready(function(){for(var b=window.location.search.split("&"),c=0;c<b.length;c++){var h=b[c].split("=");"?instanceid"!=h[0]&&"instanceid"!=h[0]||(o=h[1])}j(),i(),k(),a("#add_accion").on("click",function(){d(),j(),m(o)}),a("#add_function").on("click",function(){e(),i(),m(o),l()}),a("#add_profile").on("click",function(){f(),k(),n()}),a("#assign_user_profile").on("click",function(){g(o)})}),a("input[name='actions[]']").change(function(){a(this).attr("checked",!0)}),a("#profiles_user").change(function(){var b=a("#profiles_user").val(),c="permissions_management";a.ajax({type:"POST",data:{user:b,source:c},url:"../managers/permissions_management/permissions_report.php",success:function(b){a("input[name='actions[]'").prop("checked",!1),a.each(b,function(b,c){a("input[value='"+c+"']").prop("checked",!0)})},dataType:"json",cache:"false",error:function(a){swal({title:"Error al crear Funcionalidad.",text:"Error al cargar gestion de permisos y roles",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})}),a("body").on("click","tbody tr td .red.glyphicon.glyphicon-pencil",function(){var b=a(this).parents().eq(3).attr("id"),c=a("#"+b).DataTable(),d=c.cell(c.row(a(this).parent()).index(),0).data(),e=c.cell(c.row(a(this).parent()).index(),1).data(),f=c.cell(c.row(a(this).parent()).index(),2).data();a("#nombre_editar").prop("disabled",!1),a("#nombre_editar").val(d),a("#descripcion_editar").val(e),"tableActions"==b?(a(".form-pilos.func").removeClass("hide"),a("#save_seg").attr("name",this.id+"_accion"),a("#functions_table option").filter(function(){return a(this).text()==f}).prop("selected",!0)):"tableFunctions"==b?(a("#save_seg").attr("name",this.id+"_funcionalidad"),a(".form-pilos.func").addClass("hide")):(a("#save_seg").attr("name",this.id+"_rol"),a("#nombre_editar").prop("disabled",!0),a(".form-pilos.func").addClass("hide"))}),a(document).on("click","#save_seg",function(){var b=this.name.split("_"),c=b[0],d=b[1],e=a("#nombre_editar").val(),f=a("#descripcion_editar").val(),g="";"accion"==d&&(g=a("#functions_table").val()),a.ajax({type:"POST",data:{id:c,table:d,source:"modify_register",nombre:e,descripcion:f,funcionalidad:g},url:"../managers/permissions_management/permissions_report.php",success:function(a){swal({title:a.title,html:!0,text:a.text,type:a.type,confirmButtonColor:"#d51b23"}),j(),i(),k(),l(),m(o),n()},dataType:"json",cache:"false",error:function(a){swal({title:"Error",html:!0,text:"Se presento un inconveniente al modificar registro <br>"+a,type:"error",confirmButtonColor:"#d51b23"})}})}),a("#div_actions").on("click","#delete_action",function(){var b=a("#div_actions #tableActions").DataTable(),c=a(this).parent(),d=a(this).children("span").attr("id"),e=(b.cell(c).index().column,b.cell(b.row(c).index(),0).data());b.cell(b.row(c).index(),1).data();swal({title:"Estas seguro/a?",text:"La acción <strong>"+e+"</strong> se eliminará",type:"warning",html:!0,showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si!",cancelButtonText:"No",closeOnConfirm:!0},function(a){a&&(h(d,"accion"),j())})})}}});