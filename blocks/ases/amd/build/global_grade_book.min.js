define(["jquery","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui"],function(a,b,c,d){return{init:function(){function b(b){var c=b,d={type:"update_grade_items",course:c};a.ajax({type:"POST",data:d,url:"../managers/grade_categories/grader_processing.php",async:!1,success:function(a){"1"==a?console.log("update ok"):console.log("update fail")},dataType:"text",cache:"false",error:function(a){console.log(a)}})}function c(a){var b=!1,c=a.val();return c>5||c<0?(swal({title:"Ingrese un valor valido, entre 0 y 5. \n\rUsted ingresó: "+c,html:!0,type:"warning",confirmButtonColor:"#d51b23"}),a.val(i),b=!1):""==c&&""!=i?(a.val("0"),b=!0):b=(""!=c||""!=i)&&c!=i,b}function d(){a("#user-grades a").removeAttr("href"),a(".cat").each(function(){var b=a(this).children().next(".text");b.attr("disabled",!0),b.css("font-weight","bold")}),a(".course").each(function(){var b=a(this).children().next(".text");b.attr("disabled",!0),b.css("font-weight","bold"),b.css("font-size",16)}),a(".header").children().each(function(){a(this).removeAttr("href")})}function e(b){a("#user-grades").children().children().each(function(){void 0!=a(this).attr("data-uid")&&(f(a(this).attr("data-uid"),b)?a(this).children("th").children().each(function(){a(this).removeAttr("href"),a(this).click(function(){var b=a(this).parent().parent().attr("data-uid"),c=a("#idmoodle_"+b).attr("data-code"),d="student_profile.php";d+location.search+"&student_code="+c})}):a(this).remove())})}function f(a,b){for(var c=0;c<b.length;c++)if(b[c].split("_")[1]===a)return!0;return!1}function g(){var b=new Array;return a("#students-pilos").children().each(function(){b.push(a(this).attr("id"))}),b}function h(){for(var a=window.location.search.split("&"),b=0;b<a.length;b++){var c=a[b].split("=");if("?id_course"==c[0]||"id_course"==c[0]){var d=c[1];return d}}}var i;a(document).ready(function(){var c=g();if(e(c),d(),0!=a(".gradingerror").length){location.origin+"/moodle/grade/report/grader/index.php?id="+h();swal({title:"Recalculando ítems.",text:"Debido al proceso de actualización del campus virtual se debe realizar este paso.\nGracias por su paciencia \nDe seguir presentando este problema, por favor dirigirse al area de sistemas Ases",type:"warning",showCancelButton:!1,confirmButtonClass:"btn-danger",confirmButtonText:"Continuar",closeOnConfirm:!1},function(){b(h()),location.reload()})}}),a(document).on("blur",".text",function(){if(c(a(this))){var b=a(this).attr("id").split("_"),d=b[1],e=b[2],f=a(this).val(),g=h(),i={user:d,item:e,finalgrade:f,course:g};a.ajax({type:"POST",data:i,url:"../managers/grade_categories/grader_processing.php",async:!1,success:function(a){var b=a.nota;if(1==b){if(console.log("Nota actualizada"),f<3){var c=a.monitor,d=a.practicante,e=a.profesional;1==c?console.log("mensaje al monitor enviado correctamente"):(console.log("error monitor"),swal("Error","Error al enviar correo al monitor","error")),1==d?console.log("mensaje al practicante enviado correctamente"):(console.log("error practicante"),swal("Error","Error al enviar correo al practicante","error")),1==e?console.log("mensaje al profesional enviado correctamente"):(console.log("error profesional"),swal("Error","Error al enviar correo al profesional","error"))}}else swal("Error","Error al actualizar la nota","error")},dataType:"json",cache:"false",error:function(a){console.log(a)}})}}),a(document).on("focus",".text",function(){i=a(this).val()}),a(document).on("keypress",".text",function(a){var b=document.all?a.keyCode:a.which;return 8==b||46==b||(patron=/[0-9]/,tecla_final=String.fromCharCode(b),patron.test(tecla_final))}),a(document).on("click",".reload",function(){location.reload()})}}});