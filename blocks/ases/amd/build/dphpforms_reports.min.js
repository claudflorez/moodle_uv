'use strict';define(['jquery','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2'],function(a){return{init:function init(){function g(m,n){if('seguimiento_pares'==n){for(var o=m.length,p=0;p<o;p++){for(var s=null,u=null,w=0;w<Object.keys(m[p]).length;w++)'-#$%-'==m[p][w].respuesta&&(m[p][w].respuesta=''),('puntuacion_riesgo_individual'==m[p][w].local_alias||'puntuacion_riesgo_familiar'==m[p][w].local_alias||'puntuacion_riesgo_academico'==m[p][w].local_alias||'puntuacion_riesgo_economico'==m[p][w].local_alias||'puntuacion_vida_uni'==m[p][w].local_alias)&&('1'==m[p][w].respuesta?m[p][w].respuesta='bajo':'2'==m[p][w].respuesta?m[p][w].respuesta='medio':'3'==m[p][w].respuesta&&(m[p][w].respuesta='alto')),'revisado_profesional'==m[p][w].local_alias&&('0'==m[p][w].respuesta?m[p][w].respuesta='marcado':'-1'==m[p][w].respuesta&&(m[p][w].respuesta='no_marcado')),'revisado_practicante'==m[p][w].local_alias&&('0'==m[p][w].respuesta?m[p][w].respuesta='marcado':'-1'==m[p][w].respuesta&&(m[p][w].respuesta='no_marcado')),s&&u||('id_estudiante'==m[p][w].local_alias&&(s=m[p][w].respuesta),'id_creado_por'==m[p][w].local_alias&&(u=m[p][w].respuesta));var z=parseInt(a('#dphpforms-instance-id').data('instance-id'));a.ajax({type:'POST',url:'../managers/user_management/user_management_api.php',data:JSON.stringify({'function':'get_crea_stud_mon_prac_prof',params:[s,u,z,l]}),contentType:'application/json; charset=utf-8',dataType:'json',async:!1,success:function success(C){m[p][Object.keys(m[p]).length]={enunciado:'monitor_name',id:'00',local_alias:'monitor_name',respuesta:C.data_response.monitor.firstname+' '+(C.data_response.monitor.lastname+'')},m[p][Object.keys(m[p]).length]={enunciado:'practicing_name',id:'00',local_alias:'practicing_name',respuesta:C.data_response.practicing.firstname+' '+(C.data_response.practicing.lastname+'')},m[p][Object.keys(m[p]).length]={enunciado:'professional_name',id:'00',local_alias:'professional_name',respuesta:C.data_response.professional.firstname+' '+(C.data_response.professional.lastname+'')},m[p][Object.keys(m[p]).length]={enunciado:'created_by',id:'00',local_alias:'created_by',respuesta:C.data_response.created_by.firstname+' '+(C.data_response.created_by.lastname+'')};var D=C.data_response.student_username;D=D?C.data_response.student_username.split('-')[0]:'null',m[p][Object.keys(m[p]).length]={enunciado:'student_code',id:'00',local_alias:'student_code',respuesta:D},m[p][Object.keys(m[p]).length]={enunciado:'student_firstname',id:'00',local_alias:'student_firstname',respuesta:C.data_response.student.firstname+''},m[p][Object.keys(m[p]).length]={enunciado:'student_lastname',id:'00',local_alias:'student_lastname',respuesta:C.data_response.student.lastname+''}},failure:function failure(C){console.log(C)}});for(var B=Object.keys(m[p]).length-1;0<=B;B--)m[p][B+3]=a.extend(!0,{},m[p][B]);m[p][0]=a.extend(!0,{},m[p][Object.keys(m[p]).length-3]),m[p][1]=a.extend(!0,{},m[p][Object.keys(m[p]).length-2]),m[p][2]=a.extend(!0,{},m[p][Object.keys(m[p]).length-1]),delete m[p][Object.keys(m[p]).length-1],delete m[p][Object.keys(m[p]).length-1],delete m[p][Object.keys(m[p]).length-1],a('#progress-custom').find('div').width((100/o*(p+1)).toFixed(0)+'%'),a('#progress-custom').find('div').html((100/o*(p+1)).toFixed(0)+'%'),a('#progress-custom').find('div').attr('aria-valuenow',(100/o*(p+1)).toFixed(0))}return a('#progress-custom').find('div').addClass('progress-bar-success'),a('#message').removeClass('alert alert-info'),a('#message').addClass('alert alert-success'),a('#message').html('<strong>Info!</strong>  Reporte generado.'),m}return a('#progress-custom').find('div').addClass('progress-bar-success'),a('#message').removeClass('alert alert-info'),a('#message').addClass('alert alert-success'),a('#message').html('<strong>Info!</strong>  Reporte generado.'),m}function h(m){var n,o,p,q,r,s;if(s=m.data||null,null==s||!s.length)return null;q=m.columnDelimiter||',',r=m.lineDelimiter||'\n',p=Object.keys(s[0]);for(var u=[],v=0;v<Object.keys(s[0]).length;v++)try{u.push(s[0][v].local_alias)}catch(w){console.log('ERROR'),console.log(s[0])}return n='',n+=u.join(q),n+=r,s.forEach(function(w){o=0,p.forEach(function(z){0<o&&(n+=q);try{n+='"'+w[z].respuesta.replace(/"/g,'\'')+'"'}catch(A){}o++}),n+=r}),n}function j(m){var n,o,p=h({data:m});if(null!=p){n='reporte.csv',csvData=new Blob([p],{type:'text/csv'});var o=document.createElement('a');if(void 0!==o.download){var q=URL.createObjectURL(csvData);o.setAttribute('href',q),o.setAttribute('download',n),o.style='visibility:hidden',document.body.appendChild(o),o.click(),document.body.removeChild(o)}}}var l=null;a('#btn-generar-reporte').click(function(){var m=a('#start_date').val(),n=a('#end_date').val();if(m>=n)swal({title:'Informaci\xF3n',text:'Intervalo de fechas inv\xE1lido',type:'warning'},function(){});else if(a.ajax({type:'POST',url:'../managers/periods_management/periods_api.php',data:JSON.stringify({'function':'get_current_semester_by_apprx_interval',params:[m,n]}),contentType:'application/json; charset=utf-8',dataType:'json',async:!1,success:function success(p){l=p.data_response},failure:function failure(){}}),l){var o=JSON.parse(a('#dphpforms-reports-preguntas').html());a('.progress-bar').removeClass('progress-bar-success'),a('.progress-bar').removeClass('progress-bar-success'),a('.progress-bar').width('0%'),a('.progress-bar').html('0%'),a('.progress-bar').attr('aria-valuenow','0'),a('#progress_group').css('display','block'),a('#message').removeClass('alert alert-success'),a('#message').addClass('alert alert-info'),a('#message').html('<strong>Info!</strong> Se est\xE1 generando el reporte, esto puede tardar un par de minutos dependiendo de su conexi\xF3n a internet, capacidad del ordenador y rapidez del campus virtual.'),a.get('../managers/dphpforms/dphpforms_reverse_filter.php?id_pregunta=seguimiento_pares_fecha&cast=date&criterio={"criteria":[{"operator":">=","value":"'+m+'"},{"operator":"<=","value":"'+n+'"}]}',function(p){for(var q=Object.keys(p.results).length,r=[],s=0,u=0;u<q;u++)a.get('../managers/dphpforms/dphpforms_reverse_finder.php?respuesta_id='+p.results[u].id,function(v){a.get('../managers/dphpforms/dphpforms_get_record.php?record_id='+v.result.id_registro,function(w){if(0<Object.keys(w.record).length){for(var z=a.extend(!0,{},o),A=0;A<Object.keys(w.record.campos).length;A++)for(var B=0;B<Object.keys(z).length;B++)z[B].id==parseInt(w.record.campos[A].id_pregunta)&&(z[B].respuesta=w.record.campos[A].respuesta);r.push(z)}s++,a('#progress-download').find('div').width((100/q*s).toFixed(0)+'%'),a('#progress-download').find('div').html((100/q*s).toFixed(0)+'%'),a('#progress-download').find('div').attr('aria-valuenow',(100/q*s).toFixed(0)),s==q&&(a('#progress-download').find('div').addClass('progress-bar-success'),j(g(r,'seguimiento_pares')))}).fail(function(w){console.log(w)})}),a('#progress').text(Math.round(s));0==q&&(a('#progress').text(100),a('#message').removeClass('alert alert-info'),a('#message').addClass('alert alert-success'),a('#message').html('<strong>Info!</strong>  Reporte generado.'))})}else swal({title:'Informaci\xF3n',text:'Las fechas deben estar en el lapso de tiempo que comprende un periodo acad\xE9mico. ',type:'error'},function(){})})}}});