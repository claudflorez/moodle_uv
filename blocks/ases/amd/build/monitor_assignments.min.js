'use strict';define(['jquery','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2'],function(a){return{init:function init(){function g(j,k){a('#student_assigned').addClass('items_assigned_empty'),a('#student_assigned').html('Consultando <span>.</span><span>.</span><span>.</span>'),a('.student_item').removeClass('oculto-asignado'),a('#student_column').animate({scrollTop:a('#student_column').scrollTop()+a('#student_assigned').position().top},0),a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':'get_monitors_students_relationship_by_instance',params:[j]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(l){if(0==l.status_code){var m=l.data_response;a('.monitor_item').removeClass('active'),a('.monitor_item[data-id=\''+k+'\']').addClass('active'),a('.student_item').find('.add').removeClass('oculto-asignar'),a('.student_item').removeClass('assigned'),a('.student_item').removeClass('not-assigned'),a('.student_item').addClass('not-assigned'),a('#student_assigned').removeClass('items_assigned_empty'),a('#student_assigned').text('');for(var n=!1,o=0;o<m.length;o++)m[o].id_monitor==k?(n||(n=!0,a('#student_assigned').removeClass('items_assigned_empty')),a('.student_item[data-id=\''+m[o].id_estudiante+'\']').removeClass('not-assigned'),a('.student_item[data-id=\''+m[o].id_estudiante+'\']').addClass('assigned'),a('.student_item[data-id=\''+m[o].id_estudiante+'\']').find('.add').addClass('oculto-asignar'),a('.student_item[data-id=\''+m[o].id_estudiante+'\']').clone().appendTo('#student_assigned'),a('.student_item[data-id=\''+m[o].id_estudiante+'\']').not('#student_assigned .student_item').addClass('oculto-asignado')):(a('.student_item[data-id=\''+m[o].id_estudiante+'\']').find('.add').addClass('oculto-asignar'),a('.student_item[data-id=\''+m[o].id_estudiante+'\']').find('.delete').addClass('oculto-eliminar'),a('.student_item[data-id=\''+m[o].id_estudiante+'\']').addClass('oculto-asignado'));a('#student_assigned').find('.student_item').find('.add').addClass('oculto-asignar'),a('#student_assigned').find('.student_item').find('.delete').removeClass('oculto-eliminar'),n||(a('#student_assigned').addClass('items_assigned_empty'),a('#student_assigned').text('No tiene estudiantes asignados.'))}else console.log(l)},failure:function failure(l){console.log(l)}})}function h(j,k){a('#monitor_assigned').addClass('items_assigned_empty'),a('#monitor_assigned').html('Consultando <span>.</span><span>.</span><span>.</span>'),a('.monitor_item').removeClass('oculto-asignado'),a('#monitor_column').animate({scrollTop:a('#monitor_column').scrollTop()+a('#monitor_assigned').position().top},0),a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':'get_practicant_monitor_relationship_by_instance',params:[j]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(l){if(0==l.status_code){var m=l.data_response;a('.practicant_item').removeClass('active'),a('.practicant_item[data-id=\''+k+'\']').addClass('active'),a('.monitor_item').find('.add').removeClass('oculto-asignar'),a('.monitor_item').find('.transfer').removeClass('oculto-tranferir'),a('.monitor_item').removeClass('assigned'),a('.monitor_item').removeClass('not-assigned'),a('.monitor_item').addClass('not-assigned'),a('.student_item').removeClass('assigned'),a('.student_item').removeClass('not-assigned'),a('.student_item').addClass('not-assigned'),a('#student_assigned').text('No ha seleccionado un monitor.'),a('#student_assigned').addClass('items_assigned_empty'),a('#monitor_assigned').text('');for(var n=!1,o=0;o<m.length;o++)m[o].id_practicante==k?(n||(n=!0,a('#monitor_assigned').removeClass('items_assigned_empty')),a('.monitor_item[data-id=\''+m[o].id_monitor+'\']').removeClass('not-assigned'),a('.monitor_item[data-id=\''+m[o].id_monitor+'\']').addClass('assigned'),a('.monitor_item[data-id=\''+m[o].id_monitor+'\']').find('.add').addClass('oculto-asignar'),a('.monitor_item[data-id=\''+m[o].id_monitor+'\']').clone().appendTo('#monitor_assigned'),a('.monitor_item[data-id=\''+m[o].id_monitor+'\']').not('#monitor_assigned .monitor_item').addClass('oculto-asignado')):(a('.monitor_item[data-id=\''+m[o].id_monitor+'\']').find('.add').addClass('oculto-asignar'),a('.monitor_item[data-id=\''+m[o].id_monitor+'\']').find('.delete').addClass('oculto-eliminar'),a('.monitor_item[data-id=\''+m[o].id_monitor+'\']').addClass('oculto-asignado'));a('#monitor_assigned').find('.monitor_item').find('.add').addClass('oculto-asignar'),a('#monitor_assigned').find('.monitor_item').find('.delete').removeClass('oculto-eliminar'),a('.monitor_item').not('#monitor_assigned .monitor_item').find('.transfer').addClass('oculto-tranferir'),n||(a('#monitor_assigned').addClass('items_assigned_empty'),a('#monitor_assigned').text('No tiene monitores asignados.'))}else console.log(l)},failure:function failure(l){console.log(l)}})}a('#student-name-filter').keyup(function(){a('.student_item').removeClass('oculto-filtro-nombre');var j=a(this).val();''==j?a(this).removeClass('filter-active'):(a('.student_item').not('.item-general-list.student_item[data-name*="'+j.toUpperCase()+'"]').addClass('oculto-filtro-nombre'),a(this).addClass('filter-active'))}),a('#monitor-name-filter').keyup(function(){a('.monitor_item').removeClass('oculto-filtro-nombre');var j=a(this).val();''==j?a(this).removeClass('filter-active'):(a('.monitor_item').not('.item-general-list.monitor_item[data-name*="'+j.toUpperCase()+'"]').addClass('oculto-filtro-nombre'),a(this).addClass('filter-active'))}),a('#btn-student-name-filter').click(function(){a('#student-name-filter').val(''),a('.student_item').removeClass('oculto-filtro-nombre'),a('#student-name-filter').removeClass('filter-active')}),a('#btn-monitor-name-filter').click(function(){a('#monitor-name-filter').val(''),a('.monitor_item').removeClass('oculto-filtro-nombre'),a('#monitor-name-filter').removeClass('filter-active')}),a(document).on('click','.practicant_item',function(){h(a('#monitor_assignments_instance_id').data('instance-id'),a(this).attr('data-id'))}),a(document).on('click','.monitor_item',function(){g(a('#monitor_assignments_instance_id').data('instance-id'),a(this).attr('data-id'))}),a(document).on('click','.student_item',function(){var j=a(this).attr('data-id');a('.student_item').removeClass('active'),a(this).addClass('active'),a('.student_item[data-id=\''+j+'\']').addClass('active')}),a(document).on('click','.add',function(j){j.stopImmediatePropagation();var k=a(this),l=a('#monitor_assignments_instance_id').data('instance-id'),m=a(this).parent(),n=-1,o=m.attr('data-id'),p=m.attr('data-item'),q='';'student'==p?(q='create_monitor_student_relationship',n=a('.monitor_item.active').attr('data-id')):'monitor'==p&&(q='create_practicant_monitor_relationship',n=a('.practicant_item.active').attr('data-id')),a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':q,params:[l,n,o]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(r){0===r.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'Asignaci\xF3n registrada correctamente.',type:'success'},function(){'student'==p?(g(l,n),m.find('.add').addClass('oculto-asignar')):'monitor'==p&&(h(l,n),m.find('.add').addClass('oculto-asignar'))})},0):-5===r.status_code?'student'==p?setTimeout(function(){swal({title:'Informaci\xF3n',text:'La asignaci\xF3n ya existe en el periodo actual, si tiene problemas con esto, puede probar de nuevo recargando la pesta\xF1a.',type:'info'},function(){})},0):'monitor'==p&&setTimeout(function(){swal({title:'Informaci\xF3n',text:'Este monitor ya se encuentra asignado.',type:'info'},function(){})},0):setTimeout(function(){swal({title:'Error',text:'Reporte este error.',type:'error'},function(){})},0)},failure:function failure(r){console.log(r)}})}),a(document).on('click','.delete',function(j){j.stopImmediatePropagation();var k=a(this),l=a('#monitor_assignments_instance_id').data('instance-id'),m=a(this).parent(),n=-1,o=m.attr('data-id'),p=m.attr('data-item'),q='';'student'==p?(q='delete_monitor_student_relationship',n=a('.monitor_item.active').attr('data-id')):'monitor'==p&&(q='delete_practicant_monitor_relationship',n=a('.practicant_item.active').attr('data-id')),a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':q,params:[l,n,o]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(r){0===r.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'Asignaci\xF3n eliminada correctamente',type:'success'},function(){'student'==p?(g(l,n),m.find('.add').removeClass('oculto-asignar')):'monitor'==p&&(h(l,n),m.find('.add').addClass('oculto-asignar'))})},0):1===r.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'Est\xE1 intentando eliminar una asignaci\xF3n que ya no existe, si tiene problemas con esto, puede probar de nuevo recargando la pesta\xF1a.',type:'info'},function(){})},0):(setTimeout(function(){swal({title:'Error',text:'Reporte este error.',type:'error'},function(){})},0),console.log(r))},failure:function failure(r){console.log(r)}})}),a(document).on('click','.transfer',function(j){j.stopImmediatePropagation();var k=a(this).parent().data('name'),l=a(this).parent().data('id');a('#modalTransfer').modal('show'),a('#old_monitor_name').text(k);var m='<option value="" disabled selected>Seleccione un monitor</option>\n';a('#monitor_assigned > .monitor_item').each(function(){var n=a(this).data('name'),o=a(this).data('id');m+='<option data-old="'+l+'" data-new="'+o+'">'+n+'</option>\n'}),a('#transfer-monitor-list').html(''),a('#transfer-monitor-list').append(m)}),a(document).on('click','#btn-execute-transfer',function(){a('#modalTransfer').modal('hide');var k=a('#monitor_assignments_instance_id').data('instance-id'),m=a('#transfer-monitor-list').find(':selected').data('old'),n=a('#transfer-monitor-list').find(':selected').data('new');a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':'transfer',params:[k,m,n]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(o){0===o.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'Estudiantes transferidos correctamente.',type:'success'},function(){g(k,n)})},0):1===o.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'El monitor no tiene estudiantes para transferir.',type:'info'},function(){})},0):(setTimeout(function(){swal({title:'Error',text:'Reporte este error.',type:'error'},function(){}),swal.close()},0),console.log(o))},failure:function failure(o){console.log(o)}})}),a('select').change(function(){var j=a(this).attr('data-id').split('_')[0],k=a(this).attr('data-id').split('_')[1];if('monitor'==j&&'faculty'==k){var l=a(this).find(':selected').attr('data-id-facultad');'-1'==l?(a(this).removeClass('filter-active'),a('.item-general-list.monitor_item').removeClass('oculto-facultad')):(a(this).addClass('filter-active'),a('.item-general-list.monitor_item').removeClass('oculto-facultad'),a('.item-general-list.monitor_item').not('.item-general-list.monitor_item[data-id-facultad=\''+l+'\']').addClass('oculto-facultad'))}else if('monitor'==j&&'program'==k){var m=a(this).find(':selected').attr('data-cod-programa');'-1'==m?(a(this).removeClass('filter-active'),a('.item-general-list.monitor_item').removeClass('oculto-programa')):(a(this).addClass('filter-active'),a('.item-general-list.monitor_item').removeClass('oculto-programa'),a('.item-general-list.monitor_item').not('.item-general-list.monitor_item[data-cod-programa=\''+m+'\']').addClass('oculto-programa'))}else if('student'==j&&'faculty'==k){var l=a(this).find(':selected').attr('data-id-facultad');'-1'==l?(a(this).removeClass('filter-active'),a('.item-general-list.student_item').removeClass('oculto-facultad')):(a(this).addClass('filter-active'),a('.item-general-list.student_item').removeClass('oculto-facultad'),a('.item-general-list.student_item').not('.item-general-list.student_item[data-id-facultad=\''+l+'\']').addClass('oculto-facultad'))}else if('student'==j&&'program'==k){var m=a(this).find(':selected').attr('data-cod-programa');'-1'==m?(a(this).removeClass('filter-active'),a('.item-general-list.student_item').removeClass('oculto-programa')):(a(this).addClass('filter-active'),a('.item-general-list.student_item').removeClass('oculto-programa'),a('.item-general-list.student_item').not('.item-general-list.student_item[data-cod-programa=\''+m+'\']').addClass('oculto-programa'))}else if('professional'==j){var n=a(this).find(':selected').attr('data-id');'-1'==n?(a(this).removeClass('filter-active'),a('.item-general-list.practicant_item').removeClass('oculto-jefe')):(a(this).addClass('filter-active'),a('.item-general-list.practicant_item').removeClass('oculto-jefe'),a('.item-general-list.practicant_item').not('.item-general-list.practicant_item[data-id-jefe=\''+n+'\']').addClass('oculto-jefe'))}})}}});