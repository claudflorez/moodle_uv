'use strict';define(['jquery','block_ases/Modernizr-v282','block_ases/bootstrap','block_ases/jquery.dataTables','block_ases/sweetalert','block_ases/select2'],function(a){return{init:function init(){function h(H,I){if('primer_acercamiento'==H&&'insert'==I);else if('primer_acercamiento'==H&&'update'==I);else if('inasistencia'==H&&'insert'==I);else if('inasistencia'==H&&'update'==I){var J=a('.dphpforms-record .btn-dphpforms-univalle').length;4==J&&a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72-30+'px'})}else if('seguimiento_pares'==H&&'insert'==I);else if('seguimiento_pares'==H&&'update'==I){var K=a('.dphpforms-record').find('.revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),L=a('.dphpforms-record').find('.revisado_practicante').find('.checkbox').find('input[type=checkbox]').prop('checked');K&&(a('.btn-dphpforms-delete-record').remove(),a('.btn-dphpforms-update').remove());L&&a('.btn-dphpforms-delete-record').remove();var J=a('.dphpforms-record .btn-dphpforms-univalle').length;3==J||2==J?a('.dphpforms-record .btn-dphpforms-close').css({'margin-left':a('.dphpforms-updater').width()/2-30+'px'}):4==J&&a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72-30+'px'})}else if('seguimiento_geografico_'==H&&'insert'==I);else if('seguimiento_geografico_'==H&&'update'==I);else if('seguimiento_grupal_'==H&&'insert'==I);else if('seguimiento_grupal_'==H&&'update'==I);}function j(){a('.dphpforms-peer-record').on('click',function(){var H=a(this).attr('data-record-id');q('seguimiento_pares',H),a('#modal_v2_edit_peer_tracking').fadeIn(300)})}function k(){a('.dphpforms-groupal-record').on('click',function(){var H=a(this).attr('data-record-id');q('seguimiento_grupal',H),a('#modal_v2_edit_groupal_tracking').fadeIn(300)})}function l(H,I){var J=m('.puntuacion_riesgo_individual'),K=a('.comentarios_individual').find('textarea').val();var L=m('.puntuacion_riesgo_familiar'),M=a('.comentarios_familiar').find('textarea').val(),N=m('.puntuacion_riesgo_academico'),O=a('.comentarios_academico').find('textarea').val(),P=m('.puntuacion_riesgo_economico'),Q=a('.comentarios_economico').find('textarea').val(),R=m('.puntuacion_vida_uni'),S=a('.comentarios_vida_uni').find('textarea').val();if('3'==J||'3'==L||'3'==N||'3'==P||'3'==R){var T={'function':'send_email_dphpforms',student_code:I,risks:[{name:'Individual',risk_lvl:J,observation:K},{name:'Familiar',risk_lvl:L,observation:M},{name:'Acad\xE9mico',risk_lvl:N,observation:O},{name:'Econ\xF3mico',risk_lvl:P,observation:Q},{name:'Vida Universitaria',risk_lvl:R,observation:S}],date:a('.fecha').find('input').val(),url:window.location.href};a.ajax({type:'POST',data:JSON.stringify(T),url:'../managers/pilos_tracking/send_risk_email.php',success:function success(U){console.log(U)},dataType:'text',cache:'false',error:function error(U){console.log(U)}})}}function m(H){var I=0;return a(H).find('.opcionesRadio').find('div').each(function(){a(this).find('label').find('input').is(':checked')&&(I=a(this).find('label').find('input').val())}),I}function n(H){a.ajax({type:'POST',data:{type:'user_specific_counting',user:H,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(I){a.each(I,function(K,L){a('#counting_'+L.code).html(L.html)}),o(H),a('#loading').fadeOut('slow')},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente al cargar conteo de usuarios',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})}function o(H){var I=0,J=0,K=0,L=0,M;a('.review_prof').each(function(){I+=parseInt(a(this).text(),10)}),a('.not_review_prof').each(function(){J+=parseInt(a(this).text(),10)}),a('.review_pract').each(function(){K+=parseInt(a(this).text(),10)}),a('.not_review_pract').each(function(){L+=parseInt(a(this).text(),10)}),'profesional_ps'==H.namerol?M='PROFESIONAL':'practicante_ps'==H.namerol?M='PRACTICANTE':'monitor_ps'==H.namerol?M='MONITOR':'sistemas'==H.namerol&&(M='SISTEMAS'),advice='',advice+='<h2> INFORMACI\xD3N DE  '+M+'</h2><hr>',advice+='<div class="row">',advice+='<div class="col-sm-6">',advice+='<strong>Profesional</strong><br>',advice+='Revisado :'+I+' - No revisado : '+J+' -  Total :'+(I+J)+'</div>',advice+='<div class="col-sm-6">',advice+='<strong>Practicante</strong><br>',advice+='Revisado :'+K+' - No revisado : '+L+' -  Total :'+(K+L)+'</div></div>',a('#div-header-info').html(advice)}function p(H){a.ajax({type:'POST',data:{students:H,type:'consult_students_name'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(I){if(''!=I){a('#modal_v2_edit_groupal_tracking').find('#students').remove(),a('#modal_v2_edit_groupal_tracking').find('form').find('h1').after('<hr style="border-color:red"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 estudiantes" id="students"><h3>Estudiantes asistentes:</h3><br>'+I+'<br>')}},dataType:'text',cache:'false',error:function error(){alert('Error al consultar nombres de los estudiantes pertenecientes a un seguimiento grupal')}})}function q(H,I){a.get('../managers/dphpforms/dphpforms_forms_core.php?form_id=&record_id='+I,function(J){if('seguimiento_grupal'==H){a('#body_editor').html(''),a('#modal_v2_edit_groupal_tracking').find('#body_editor').html(''),a('#modal_v2_edit_groupal_tracking').find('#body_editor').append(J),a('#modal_v2_edit_groupal_tracking').find('.btn-dphpforms-univalle').remove();var K=a('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val();p(K)}else{a('#modal_v2_edit_groupal_tracking').find('#body_editor').html(''),a('#body_editor').html(''),a('#body_editor').append(J),a('.dphpforms.dphpforms-record.dphpforms-updater').append('<br><br><div class="div-observation col-xs-12 col-sm-12 col-md-12 col-lg-12 comentarios_vida_uni">Observaciones de Practicante/profesional:<br> <textarea id="observation_text" class="form-control " name="observation_text" maxlength="5000"></textarea><br><a id="send_observation" class="btn btn-sm btn-danger btn-dphpforms-univalle btn-dphpforms-send-observation">Enviar observaci\xF3n</a></div>'),a('button.btn.btn-sm.btn-danger.btn-dphpforms-univalle').attr('id','button');var L=J.indexOf('seguimiento_de_pares_');-1!=L&&h('seguimiento_pares','update');var M=J.indexOf('inasistencia');-1!=M&&h('inasistencia','update')}a('#permissions_informationr').html('');var N=a('.dphpforms-record').find('.revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),O=a('.dphpforms-record').find('.revisado_practicante').find('.checkbox').find('input[type=checkbox]').prop('checked');N&&a('.dphpforms-record').find('.btn-dphpforms-delete-record').remove();for(var P=JSON.parse(a('#permissions_information').text()),Q=0;Q<P.behaviors_permissions.length;Q++){for(var U,R=P.behaviors_permissions[Q].behaviors[0],S=R.behaviors_accessibility,T=0;T<S.length;T++)U=S[T].disabled,'true'==U?U=!0:'false'==U&&(U=!1),a('.dphpforms-record').find('#'+S[T].id).prop('disabled',U),a('.dphpforms-record').find('.'+S[T]['class']).prop('disabled',U);for(var V=R.behaviors_fields_to_remove,T=0;T<V.length;T++)a('.dphpforms-record').find('#'+V[T].id).remove(),a('.dphpforms-record').find('.'+V[T]['class']).remove();for(var W=R.limpiar_to_eliminate,T=0;T<W.length;T++)a('.dphpforms-record').find('.'+W[T]['class']+'.limpiar ').remove()}a('#permissions_informationr').html('')})}function r(){a('a[class*="practicant"]').click(function(){var H=a(this).attr('href').split('#practicant')[1],I=a(this).attr('href');a.ajax({type:'POST',data:{type:'get_practicants_of_professional',practicant_code:H,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(J){a(I+' > div').empty(),a(I+' > div').append(J.render);var K=J.counting;a.each(K,function(L,M){a('#counting_'+M.code).html(M.html)}),s(),t()},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente con el practicante seleccionado.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function s(){a('a[class*="monitor"]').click(function(){var H=a(this).attr('href').split('#monitor')[1],I=a(this).attr('href');a.ajax({type:'POST',data:{type:'get_monitors_of_practicant',monitor_code:H,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(J){a(I+' > div').empty(),a(I+' > div').append(J),u(),t()},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente con el monitor seleccionado.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function t(){a('a[class*="groupal"]').click(function(){var H=a(this).attr('href').split('#groupal')[1],I=a(this).attr('href');a.ajax({type:'POST',data:{type:'get_groupal_trackings',student_code:H,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(J){a(I+' > div').empty(),a(I+' > div').append(J),k()},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente con los seguimientos grupales seleccionados.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function u(){a('a[class*="student"]').click(function(){var H=a(this).attr('href').split('#student')[1],I=a(this).attr('href');a.ajax({type:'POST',data:{type:'get_student_trackings',student_code:H,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(J){a(I+' > div').empty(),a(I+' > div').append(J),j(),k()},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente con el estudiante seleccionado.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})}),a('.see_history').unbind().click(function(){var I=a(this).parents().eq(3).attr('href').split('#monitor')[1];a.ajax({type:'POST',data:{type:'redirect_tracking_time_control',monitor:I},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(J){var K=window.location.href,L=K.replace('report_trackings','tracking_time_control');try{var M=window.open(L+'&&monitorid='+J,'_blank');M&&M.focus()}catch(N){alert('Se ha producido un error al abrir la ventana : '+N)}},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente al reedirecionar al reporte de horas.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function v(H){a('#periodos').change(function(){if('sistemas'!=G){var J=a('#periodos').val(),K=D;a.ajax({type:'POST',data:{id_persona:K,id_semestre:J,instance:H,otro:!0,type:'consulta_sistemas'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(L){''==L?a('#reemplazarToogle').html('<label> No se encontraron registros </label>'):(a('#reemplazarToogle').html(L),u(),s(),r(),t()),a('.well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto').slideDown('slow')},dataType:'text',cache:'false',error:function error(){swal('ERROR!','Oops!, Se present\xF3 un error al consultar seguimientos de personas','error')}}),j(),k()}})}function w(H){a('#personas').val('').change(),a('#personas').select2({placeholder:'Seleccionar persona',language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}}),a('#periodos').select2({language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}}),A(H,G),a('#consultar_persona').on('click',function(){var I=a('#personas').children(':selected').attr('value'),J=a('#periodos').children(':selected').attr('value');I==void 0?swal({title:'Debe escoger una persona para realizar la consulta',html:!0,type:'warning',confirmButtonColor:'#d51b23'}):(a('.well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto').show(),a('.se-pre-con').show(),a('#reemplazarToogle').hide(),a.ajax({type:'POST',data:{id_persona:I,id_semestre:J,instance:B(),type:'consulta_sistemas'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(L){''==L?a('#reemplazarToogle').html('<label> No se encontraron registros </label>'):(a('#reemplazarToogle').html(L),a('input[name=practicante]').prop('disabled',!0),a('input[name=profesional]').prop('disabled',!0)),u(),s(),r(),t(),a('.well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto').slideDown('slow')},dataType:'text',cache:'false',error:function error(){swal('ERROR!','Oops!, Se present\xF3 un error al cargar seguimientos de personas','error')},complete:function complete(){a('.se-pre-con').hide(),a('#reemplazarToogle').fadeIn()}}),j(),k())})}function y(H){a('body').on('click','#send_observation',function(){var I=a('form').serializeArray(),J={};a(I).each(function(T,U){J[U.name]=U.value});var K=J.id_registro,L=a('#observation_text');if(''==L.val())swal({title:'Para enviar una observaci\xF3n debe llenar el campo correspondiente',html:!0,type:'error',confirmButtonColor:'#d51b23'});else{var M='individual',N=a('.id_creado_por').find('input').val();''==N&&(N=a('.in_id_creado_por').find('input').val(),M='individual_inasistencia');var O=a('.fecha').find('input').val();''==O&&(O=a('.in_fecha').find('input').val());var P=L.val(),Q=a('#periodos').val(),R=a('.lugar').find('input').val();''==R&&(R=a('.in_lugar').find('input').val());a.ajax({type:'POST',data:{id_tracking:K,type:'send_email_to_user',form:'new_form',tracking_type:M,monitor_code:N,date:O,message_to_send:P,semester:Q,instance:H,place:R},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(T){'Error'==T?(console.log('mensaje error : '),console.log(T),swal({title:'error al enviar el correo al monitor',html:!0,type:'error',confirmButtonColor:'#d51b23'})):(swal({title:'Correo enviado',html:!0,type:'success',confirmButtonColor:'#d51b23'}),L.val(''))},dataType:'text',cache:'false',error:function error(T){console.log('mensaje error : '),console.log(T),swal('ERROR!','Oops!, Se present\xF3 un error al enviar el correo','error')}})}})}function A(H,I){a('#periodos').change(function(){var J=a('#periodos').val();a.ajax({type:'POST',data:{id:J,instance:H,type:'update_people'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(K){if(a('#personas').empty(),a('#personas').select2({placeholder:'Seleccionar persona',language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}}),'sistemas'==I){a('#personas').attr('selectedIndex','-1').find('option:selected').removeAttr('selected'),a('#personas').append('<option value="">Seleccionar persona</option>'+K)}},dataType:'text',cache:'false',error:function error(){swal('ERROR!','Oops!, Se present\xF3 un error al cargar personas','error')}})})}function B(){for(var J,H=window.location.search.split('&'),I=0;I<H.length;I++)if(J=H[I].split('='),'?instanceid'==J[0]||'instanceid'==J[0])var K=J[1];return K}var C=0,D=0,E='',F='',G='';a(document).on('click','.btn-dphpforms-close',function(){a(this).closest('div[class="mymodal"]').fadeOut(300)}),a('.outside').click(function(){var H=a(this);swal({title:'Confirmaci\xF3n de salida',text:'',type:'warning',showCancelButton:!0,confirmButtonText:'Salir'},function(I){I&&a(H).parent('.mymodal').fadeOut(300)})}),a(document).ready(function(){a('.se-pre-con').fadeOut('slow'),a('#reemplazarToogle').fadeIn('slow'),a.ajax({type:'POST',data:{type:'getInfo',instance:B()},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(I){$data=a.parseJSON(I),E=$data.username,D=$data.id,F=$data.email,C=$data.rol,G=$data.name_rol},dataType:'text',cache:'false',error:function error(){swal({title:'error al obtener informaci\xF3n del usuario, getInfo.',html:!0,type:'error',confirmButtonColor:'#d51b23'})}}),E='';var H=[];H.id=D,H.name=E,H.namerol=G,n(H),'practicante_ps'==G?(v(B(),H),y(B())):'profesional_ps'==G?(v(B(),H),y(B())):'monitor_ps'==G?(v(B(),H),y(B())):'sistemas'==G&&(w(B()),y(B()))});a(document).on('click','.dphpforms > #button',function(H){H.preventDefault(),a(':disabled').prop('disabled',!1);var I=new FormData,J=a(this).parent(),K=J.attr('action');'procesador.php'==J.attr('action')&&(K='../managers/dphpforms/procesador.php');var L=J.find('.id_estudiante').find('input').val();a.ajax({type:'POST',url:K,data:a('form.dphpforms').serialize(),dataType:'json',success:function success(M){var N=M;if(0==N.status){a.get('../managers/pilos_tracking/api_pilos_tracking.php?function=update_last_user_risk&arg='+L+'&rid=-1',function(P){console.log(P)});var O='';'Stored'==N.message?O='Almacenado':'Updated'==N.message&&(O='Actualizado'),l(!1,L),swal({title:'Informaci\xF3n',text:O,type:'success'},function(){'Updated'==N.message&&a('#dphpforms-peer-record-'+a('#dphpforms_record_id').val()).stop().animate({backgroundColor:'rgb(175, 255, 173)'},400).animate({backgroundColor:'#f5f5f5'},4e3)}),a('.dphpforms-response').trigger('reset'),a('#modal_v2_edit_peer_tracking').fadeOut(300),a('#modal_v2_peer_tracking').fadeOut(300)}else if(-2==N.status){var O='';'Without changes'==N.message?(O='No hay cambios que registrar',a('#modal_v2_edit_peer_tracking').fadeOut(300),a('#modal_v2_peer_tracking').fadeOut(300),a('#modal_primer_acercamiento').fadeOut(300),a('#modal_seguimiento_geografico').fadeOut(300)):'Unfulfilled rules'==N.message&&(O='Revise los valores ingresados'),swal('Alerta',O,'warning')}else-1==N.status&&swal('ERROR!','Oops!, informe de este error','error')},error:function error(){swal('Error!','Oops!, informe de este error','error')}})}),a('.mymodal-close').click(function(){a(this).parent().parent().parent().parent().fadeOut(300)}),u(),s(),r(),t()}}});