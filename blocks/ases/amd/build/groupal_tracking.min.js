'use strict';define(['jquery','block_ases/bootstrap','block_ases/validator','block_ases/sweetalert'],function(a){return{init:function init(){function f(){var u=[];return a('#mytable_consult > tbody  > tr > td').each(function(){'talentos'==a(this).attr('id')&&u.push(a(this).html())}),u}function g(){for(var A,v=[],w=document.location.search.substring(1),y=w.split('&'),z=0;z<y.length;z++)A=y[z].split('='),v[A[0]]=A[1];return v}function h(){var u=[],v=g(document.location.search);u.push({name:'function',value:'load_grupal'}),u.push({name:'idinstancia',value:v.instanceid}),a.ajax({type:'POST',data:u,url:'../managers/user_management/usermanagement_report.php',success:function success(w){if(a('#mytable tbody').html(''),0!=w.rows){var y=w.content;for(x in y)a('#mytable tbody').append('<tr> <td>'+y[x].username+'</td> <td>'+y[x].firstname+'</td> <td>'+y[x].lastname+'</td>  <td class="hide">'+y[x].idtalentos+'</td> </tr>')}else a('#list_grupal_seg').append('<a>No registra ningun estudiante a su cargo.Por favor dirigete a la oficina de Sistemas de talentos pilos para gestionar tu situaci\xF3n</a>')},dataType:'json',cache:'false',error:function error(){alert('error al cargar estudiantes')}})}function j(u,v){u===void 0&&(u=null),v===void 0&&(v=null);var w=[],y=g(document.location.search);w.push({name:'function',value:'load_grupal'}),w.push({name:'idinstancia',value:y.instanceid}),a.ajax({type:'POST',data:w,url:'../managers/user_management/usermanagement_report.php',success:function success(z){if(a('#seguimiento #mytable_consult tbody').html(''),0!=z.rows){var A=z.content;if(!u)for(x in A)a('#seguimiento #mytable_consult tbody').append('<tr> <td>'+A[x].username+'</td> <td>'+A[x].firstname+'</td> <td>'+A[x].lastname+'</td>  <td><input type="checkbox" id="asistencia" name="asistencia" value="'+A[x].idtalentos+'"/></td>  </tr>');else for(x in A)-1==u.indexOf(x)?a('#seguimiento #mytable_consult tbody').append('<tr> <td>'+A[x].username+'</td> <td>'+A[x].firstname+'</td> <td>'+A[x].lastname+'</td>  <td><input type="checkbox" id="asistencia" name="asistencia" value="'+A[x].idtalentos+'"/></td>  </tr>'):a('#seguimiento #mytable_consult tbody').append(' <tr> <td>'+A[x].username+'</td> <td>'+A[x].firstname+'</td> <td>'+A[x].lastname+'</td>  <td><input type="checkbox" checked="checked" id="asistencia" name="asistencia"  value="'+A[x].idtalentos+'"/></td>  </tr>')}else a('#seguimiento #list_grupal_seg').append('<a>No registra ningun estudiante a su cargo.Por favor dirigete a la oficina de Sistemas de talentos pilos para gestionar tu situaci\xF3n</a>');var B=a('#upd_seg').prop('name');a('#edit_seg').prop('name',B)},dataType:'json',cache:'false',error:function error(){alert('error al cargar listado de asistencia')}})}function l(){for(var u=new Date,v=u.getDate(),w=u.getMonth()+1,y=u.getFullYear(),z=u.getMinutes(),A=u.getHours(),B='',C=0;24>C;C++)C==A?(10>A&&(A='0'+A),B+='<option value="'+A+'" selected>'+A+'</option>'):B+=10>C?'<option value="0'+C+'">0'+C+'</option>':'<option value="'+C+'">'+C+'</option>';for(var D='',C=0;60>C;C++)C==z?(10>z&&(z='0'+z),D+='<option value="'+z+'" selected>'+z+'</option>'):D+=10>C?'<option value="0'+C+'">0'+C+'</option>':'<option value="'+C+'">'+C+'</option>';a('#seguimiento #h_ini').append(B),a('#seguimiento #m_ini').append(D),a('#seguimiento #h_fin').append(B),a('#seguimiento #m_fin').append(D),a('#seguimiento').find('input:text, textarea').val(''),a('#seguimiento #infomonitor').addClass('hide'),a('#upd_seg').attr('disabled',!1),a('#upd_seg').attr('title',''),a('#seguimiento').find('select, textarea, input').attr('disabled',!1)}function m(){a('#list_grupal').html('');var u=[],v=g(document.location.search);u.push({name:'function',value:'loadSegMonitor'}),u.push({name:'tipo',value:'GRUPAL'}),u.push({name:'idinstancia',value:v.instanceid}),a.ajax({type:'POST',data:u,url:'../managers/seguimiento_grupal/groupal_trackings_report.php',success:function success(w){var y=w.error;if(!y){var z=w.result,A=w.rows;if(0<A){for(x in z)a('#list_grupal').append('<div class="container well col-md-12"> <div class="container-fluid col-md-10" name="info"><div class="row"><label class="col-md-3" for="fecha_des">Fecha</label><label class="col-md-9" for="tema_des">Tema</label> </div> <div class="row"> <input type="text" class="col-md-3" value='+z[x].fecha+' id="fecha_seg" name="fecha_seg" disabled> <input type="text" class="col-md-9" value='+z[x].tema+' id="tema_seg" name="tema_seg" disabled> </div></div> <div id='+z[x].id+' class="col-md-2" name="div_button_seg"> <span class="btn btn-danger" id="consult_grupal" name="consult_grupal" data-toggle="modal" data-target="#myModal">Detalle</span><span class="btn btn-warning" id="delete_grupal" name="delete_grupal">Borrar</span> </div></div>');a('#list_grupal').on('click','#consult_grupal',function(){var B=a(this).parent().attr('id');a('#upd_seg').removeClass('hide'),a('#upd_seg').prop('name',B),o(B,'GRUPAL')}),a('#list_grupal').on('click','#delete_grupal',function(){var B=a(this).parent().attr('id');n(B)})}else a('#list_grupal').append('<label>No registra</label><br>')}else swal({title:y,html:!0,type:'error',text:w.msg,confirmButtonColor:'#D3D3D3'})},dataType:'json',cache:'false',error:function error(){alert('error al cargar seguimiento monitor')}})}function n(u){swal({title:'\xBFSeguro que desea eliminar el registro?',text:'No podr\xE1s deshacer este paso',type:'warning',showCancelButton:!0,cancelButtonText:'No',confirmButtonColor:'#d51b23',confirmButtonText:'Si',closeOnConfirm:!1},function(){a.ajax({type:'POST',data:{id:u,'function':'delete'},url:'../../../blocks/ases/managers/seguimiento_grupal/groupal_trackings_report.php',async:!1,success:function success(v){0==v?swal({title:'error al borrar registro',html:!0,type:'error',confirmButtonColor:'#d51b23'}):(setTimeout('document.location.reload()',500),swal('\xA1Hecho!','El registro ha sido eliminado','success'))},dataType:'text',cache:'false',error:function error(){alert('error al eliminar seguimiento')}})})}function o(u,v){var y=[],z=g(document.location.search);a('#save_seg').addClass('hide'),l(),y.push({name:'function',value:'getSeguimiento'}),y.push({name:'id',value:u}),y.push({name:'idinstancia',value:z.instanceid}),y.push({name:'tipo',value:v}),a.ajax({type:'POST',data:y,url:'../managers/seguimiento_grupal/groupal_trackings_report.php',success:function success(A){var B=A.error;if(!!B)swal({title:B,html:!0,type:'error',text:A.msg,confirmButtonColor:'#D3D3D3'});else if(a('#place').val(A.seguimiento.lugar),a('#tema').val(A.seguimiento.tema),a('#objetivos').val(A.seguimiento.objetivos),a('#actividades').val(A.seguimiento.actividades),a('#observaciones').val(A.seguimiento.observaciones),a('#h_ini option[value='+A.hour.h_ini+']').attr('selected',!0),a('#m_ini option[value='+A.hour.m_ini+']').attr('selected',!0),a('#h_fin option[value='+A.hour.h_fin+']').attr('selected',!0),a('#m_fin option[value='+A.hour.m_fin+']').attr('selected',!0),a('#date').val(A.hour.seguimiento.fecha),a('#seguimiento :input').prop('disabled',!0),a('#mytable_consult tbody').html(''),0!=A.rows){var C=A.content;for(x in C)a('#mytable_consult tbody').append('<tr> <td>'+C[x].username+'</td> <td>'+C[x].firstname+'</td> <td>'+C[x].lastname+'</td>  <td id="talentos"  class = "hide">'+C[x].idtalentos+'</td> </tr>')}else a('#list_grupal_seg_consult').append('<a>No registra ningun estudiante a su cargo.Por favor dirigete a la oficina de Sistemas de talentos pilos para gestionar tu situaci\xF3n</a>')},dataType:'json',cache:'false',error:function error(){alert('error al ver detalles de seguimientos')}})}function p(u){var v=!0,w='',y,z,A,B,C,D,E,F,G;a.each(u,function(I,J){switch(J.name){case'date':y=J.value;break;case'place':G=J.value;break;case'h_ini':z=J.value;break;case'm_ini':A=J.value;break;case'h_fin':B=J.value;break;case'm_fin':C=J.value;break;case'tema':D=J.value;break;case'objetivos':E=J.value;break;case'actividades':actividades=J.value;break;case'observaciones':observaciones=J.value;break;case'idtalentos':F=J.value;}}),y||(v=!1,w+='* Selecciona una Fecha de seguimiento valida: date<br>'),(G==void 0||''==G)&&(w+='* Seleccione el lugar : lugar<br>',v=!1),(actividades==void 0||''==actividades)&&(w+='* Seleccione las actividades que se realizaron : actividades<br>',v=!1),(observaciones==void 0||''==observaciones)&&(w+='* Seleccione las observaciones : observaciones<br>',v=!1),z>B?(v=!1,w+='* La hora final debe ser mayor a la inicial<br>'):z==B&&A>C&&(v=!1,w+='* La hora final debe ser mayor a la inicial<br>'),0===F.length&&(v=!1,w+='* Selecciona los estudiantes que asistieron al seguimiento: '+F.length+'<br>'),''==D&&(v=!1,w+='* La informacion de "observaciones" es obligatoria :'+D+'<br>'),''==E&&(v=!1,w+='* La informacion de "Objetivos" es obligatoria:'+E+'<br>');var H={isvalid:v,detalle:w};return H}function q(){var u=a('#ficha_estudiante #codigo').serializeArray();a.ajax({type:'POST',data:u,url:'../managers/search_profile.php',success:function success(v){var w=v.error;if(a('#ficha_estudiante input,textarea').val(''),a('#ficha_estudiante #nombreficha').text(''),a('#ficha_estudiante #email').text(''),a('#ficha_estudiante #cohorte').text(''),!w){var y=g(document.location.search);canSeeStudent(v.idtalentos,y,function(z){if(z.result){var A=location.search.split('&'),B=location.href.split('?')[0]+A[0]+'&'+A[1]+'&talento_id='+v.username;location.href=B}else swal({title:'\xC1REA RESTRINGIDA',html:!0,type:'warning',text:'No tienes permisos para ver la informaci\xF3n de este estudiante.<br> Dirigete a la oficina de Sistemas del plan talentos pilos para gestionar tu situaci\xF3n',confirmButtonColor:'#d51b23'},function(C){C&&(location.href=z.pagina)})})}else swal({title:'No encotrado',html:!0,type:'error',text:w,confirmButtonColor:'#d51b23'},function(z){if(z){var A=location.search.split('&');window.history.pushState(null,null,'talentos_profile.php'+A[0]+'&'+A[1])}})},dataType:'json',cache:'false',error:function error(v){alert('Error '+v)}})}a('.outside').click(function(){var u=a(this);swal({title:'Confirmaci\xF3n de salida',text:'',type:'warning',showCancelButton:!0,confirmButtonText:'Salir'},function(v){v&&(a(u).parent('.mymodal').fadeOut(300),console.log(a(this).parent('.mymodal')))})}),a(document).ready(function(){h(),m(),a('#socioedu_add_grupal').click(function(){a('#save_seg').removeClass('hide'),a('#div_created').addClass('hide'),a('#upd_seg').addClass('hide'),a('#myModalLabel').attr('name','GRUPAL'),l(),j()}),a('#close_seg').on('click',function(){a('#edit_seg').addClass('hide')}),a('#go_back').on('click',function(){window.history.back()}),a('#edit_seg').click(function(){var u=[],v=g(document.location.search),w=a(this).prop('name');a('#seguimiento input[id=asistencia]:checked').each(function(){var B=a(this).val();u.push(B)}),a('#myModalLabel').attr('name','GRUPAL');var y=a('#myModalLabel').attr('name'),z=a('#seguimiento').serializeArray();z.push({name:'function',value:'update'}),z.push({name:'tipo',value:y}),z.push({name:'id_seg',value:w}),z.push({name:'idtalentos',value:u}),z.push({name:'idinstancia',value:v.instanceid}),z.push({name:'idmonitor',value:120});var A=p(z);A.isvalid?a.ajax({type:'POST',data:z,url:'../managers/seguimiento_grupal/groupal_trackings_report.php',success:function success(B){var C=B.error;C?swal({title:C,html:!0,type:'error',text:B.msg,confirmButtonColor:'#D3D3D3'}):(swal({title:'Actualizado con exito!!!',html:!0,type:'success',text:B.msg,confirmButtonColor:'#d51b23'}),a('#myModal').modal('toggle'),a('#myModal').modal('toggle'),a('#save_seg').addClass('hide'),a('.modal-backdrop').remove(),m())},dataType:'json',cache:'false',error:function error(){alert('error al actualizar seguimiento')}}):swal({title:'Error',html:!0,type:'warning',text:'Detalles del error:<br>'+A.detalle,confirmButtonColor:'#D3D3D3'})}),a('#save_seg').click(function(){var u=[],v=g(document.location.search);a('#seguimiento input[id=asistencia]:checked').each(function(){var A=a(this).val();u.push(A)});var w=a('#myModalLabel').attr('name'),y=a('#seguimiento').serializeArray();y.push({name:'function',value:'new'}),y.push({name:'tipo',value:w}),y.push({name:'idtalentos',value:u}),y.push({name:'idinstancia',value:v.instanceid}),y.push({name:'idmonitor',value:120});var z=p(y);z.isvalid?a.ajax({type:'POST',data:y,url:'../managers/seguimiento_grupal/groupal_trackings_report.php',success:function success(A){var B=A.error;B?swal({title:B,html:!0,type:'error',text:A.msg,confirmButtonColor:'#D3D3D3'}):(swal({title:'Actualizado con exito!!',html:!0,type:'success',text:A.msg,confirmButtonColor:'#d51b23'}),a('#myModal').modal('toggle'),a('#myModal').modal('toggle'),a('#save_seg').addClass('hide'),a('.modal-backdrop').remove(),m())},dataType:'json',cache:'false',error:function error(){alert('error al guardar seguimiento')}}):swal({title:'Error',html:!0,type:'warning',text:'Detalles del error:<br>'+z.detalle,confirmButtonColor:'#D3D3D3'})}),a('#upd_seg').click(function(){a(this).attr('name');a('#seguimiento :input').prop('disabled',!1);var v=f();j(v,!0),a('#edit_seg').removeClass('hide'),a('#upd_seg').addClass('hide')})}),a('#ficha_estudiante #editar_ficha').click(function(){a('#ficha_estudiante').find('input, textarea').prop('readonly',!1),a('#profesional_ps').prop('readonly',!0),a('#practicante_ps').prop('readonly',!0),a('#monitor_ps').prop('readonly',!0),a('#ficha_estudiante').find('select').prop('disabled',!1),a(this).hide(),a('#ficha_estudiante #cancel').fadeIn(),a('#ficha_estudiante #save').fadeIn(),a('#ficha_estudiante #codigo').attr('readonly',!0),a('#ficha_estudiante #search').fadeOut()}),a('#ficha_estudiante #cancel').click(function(){swal({title:'Estas seguro/a de cancelar?',text:'Los cambios realizados no ser\xE1n tomados en cuenta y se perder\xE1n',type:'warning',showCancelButton:!0,confirmButtonColor:'#d51b23',confirmButtonText:'Si!',cancelButtonText:'No',closeOnConfirm:!0},function(u){u&&(a('#ficha_estudiante').find('input, textarea').prop('readonly',!0),a('#ficha_estudiante').find('select').prop('disabled',!0),a(this).hide(),a('#ficha_estudiante #save').fadeOut(),a('#ficha_estudiante #cancel').fadeOut(),a('#ficha_estudiante #editar_ficha').fadeIn(),a('#ficha_estudiante #codigo').attr('readonly',!1),a('#ficha_estudiante #search').fadeIn(),q())})}),a('#ficha_estudiante #go_back').on('click',function(){var v=location.search.split('&');location.href='index.php'+v[0]+'&'+v[1]}),a('#ficha_estudiante').on('click','.accordion-toggle',function(u){u.preventDefault();var v=a(this),w=v.next('.accordion-content'),y=a(this).children('.toggle-icon');v.toggleClass('open'),v.hasClass('open')?y.html('<i class=\'glyphicon glyphicon-chevron-down whitesmoke\'></i>'):y.html('<i class=\'glyphicon glyphicon-chevron-left\'></i>'),w.slideToggle(250)}),a(document).on('click','panel-heading',function(){a('.panel-collapse.in').removeClass('in').addClass('collapse')})}}});
