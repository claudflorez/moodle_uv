define(['jquery','local_customgrader/bootstrap','local_customgrader/sweetalert','local_customgrader/jqueryui'],function(a){return{init:function init(){function c(p,q,r){a.ajax({type:'POST',data:{course:p,element:q,type_e:r,type:'loadParentCat'},url:'managers/ajax_processing.php',success:function success(s){console.log(s),a('#padre').html(s.html)},dataType:'json',cache:'false',error:function error(s){console.log('ajax error'),console.log(s)}})}function d(p,q,r){a.ajax({type:'POST',data:{type_ajax:'deleteElement',id:p,courseid:q,type:r},url:'managers/ajax_processing.php',success:function success(s){swal({title:'Listo',text:s.msg,type:'success',showCancelButton:!1,showConfirmButton:!1,timer:1200}),g(q)},dataType:'json',cache:'false',error:function error(s){console.log(s)}})}function f(){for(var p=window.location.search.split('='),q=0;q<p.length;q+=2)if('?id'==p[q])var r=p[q+1];return r}function g(p){a.ajax({type:'POST',data:{course:p,type:'loadCat'},url:'managers/ajax_processing.php',success:function success(q){a('#mymodalbody').html(q)},dataType:'text',cache:'false',error:function error(q){console.log(q)}})}function h(p,q){var r=a('#tipoItem').val(),s=f();if('CATEGOR\xCDA'==r){if(m(p)){var t=a.trim(a('#inputNombre').val()),u=a('#inputValor').val(),v=j(a('#tipoCalificacion').prop('selectedIndex'));a.ajax({type:'POST',data:{course:s,parent:q,fullname:t,agregation:v,tipo:r,peso:u},url:'managers/ajax_processing.php',success:function success(w){1==w?(swal({title:'Categoria a\xF1adida con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),g(s)):0==w&&swal({title:'Error al a\xF1adir la categoria (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(w){swal({title:'Error al intentar a\xF1adir la categoria',html:!0,type:'error',confirmButtonColor:'#d51b23'}),console.log(w)}})}}else if('\xCDTEM'==r){if(k(p)){var t=a.trim(a('#inputNombre').val()),u=a('#inputValor').val();a.ajax({type:'POST',data:{course:s,parent:q,fullname:t,tipo:r,peso:u},url:'managers/ajax_processing.php',success:function success(w){1==w?(swal({title:'item a\xF1adido con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),g(s)):0==w&&swal({title:'Error al a\xF1adir el item (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(w){swal({title:'Error al intentar a\xF1adir el item',html:!0,type:'error',confirmButtonColor:'#d51b23'}),console.log(w)}})}}else if(!('PARCIAL'==r))swal({title:'Seleccione el tipo de elemento que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'});else if(l(p)){var t=a.trim(a('#inputNombre').val()),u=a('#inputValor').val();a.ajax({type:'POST',data:{course:s,parent:q,fullname:t,agregation:6,tipo:r,peso:u},url:'managers/ajax_processing.php',success:function success(w){1==w?(swal({title:'Categoria a\xF1adida con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),g(s)):0==w&&swal({title:'Error al a\xF1adir la categoria (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(w){swal({title:'Error al intentar a\xF1adir la categoria',html:!0,type:'error',confirmButtonColor:'#d51b23'}),console.log(w)}})}}function j(p){switch(p){case 1:return 0;break;case 2:return 10;}}function k(p){var q=a.trim(a('#inputNombre').val());if(''==q)return swal({title:'Ingrese el nombre del \xEDtem que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==p){var r=a('#inputValor').val();if(''==r)return swal({title:'Ingrese un peso v\xE1lido entre 0 y '+o,html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}return!0}function l(p){var q=a.trim(a('#inputNombre').val());if(''==q)return swal({title:'Ingrese el nombre del parcial que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==p){var r=a('#inputValor').val();if(''==r)return swal({title:'Ingrese un peso v\xE1lido entre 0 y '+o,html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}return!0}function m(p){if(0==a('#tipoCalificacion').prop('selectedIndex'))return swal({title:'Seleccione el tipo de calificaci\xF3n de la categor\xEDa que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;var q=a.trim(a('#inputNombre').val());if(''==q)return swal({title:'Ingrese el nombre de la categor\xEDa que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==p){var r=a('#inputValor').val();if(''==r)return swal({title:'Ingrese un peso v\xE1lido entre 0 y '+o,html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}else;return!0}var n,o;a(document).on('click','#wizard_button',function(){a('#modalCategories').modal({backdrop:!1}),a('.fondo').show()}),a(document).on('click','#tutorial-button',function(){a('#video-frame').attr('src','https://www.youtube.com/embed/8Bm_obAFBYo'),a('#tutorialModal').modal({backdrop:!1}),a('.fondo').show()}),a(document).on('click','#close-tutorial',function(){a('.fondo').hide()}),a('#tutorialModal').on('hidden.bs.modal',function(){a('#video-frame').attr('src','')}),a(document).on('click','#cancel',function(){a('.fondo').hide()}),a(document).on('click','.mymodal-close',function(){location.reload()}),a(document).on('click','.edit',function(){var p=a(this).attr('title');a('#titulo').text(p);var q=!1;a('#nombre_editar').show(),a('#label_nombre').show(),a('#alta').show(),a('#div_padres').show(),a(this).hasClass('curso')&&(q=!0,a('#alta').hide(),a('#nombre_editar').hide(),a('#label_nombre').hide(),a('#div_padres').hide());var r=f(),s=a(this).attr('id');if(a('#save_edit').attr('name',s),'Editar Categor\xEDa'===p){a('#type_cal').show();var t=a(this).parent().parent().attr('id');a('#otro').hide(),10!=t&&0!=t&&6!=t&&(t=99,a('#otro').show()),a('#calific').prop('value',t);var u='cat',v=a(this).parent().parent().text();if(-1==v.search('-')){var w=v.split('(');v=w[0],y=w[1],q||a('#peso').show(),y=y.replace('(',''),y=y.replace(')',''),y=y.replace(' ',''),y=y.replace('%',''),n=y,a('#peso_editar').val(y);var x=a(this).attr('data-maxweight');a('.maxweight-edit').attr('id',x)}else v=v.split('-')[0],a('#peso').hide()}else{a('#type_cal').hide();var y=a(this).parent().parent().prev().text();if('-'==y)a('#peso').hide(),a('#peso_editar').val(y);else{a('#peso').show(),y=y.replace('(',''),y=y.replace(')',''),y=y.replace(' ',''),y=y.replace('%',''),n=y,a('#peso_editar').val(y);var x=a(this).parent().attr('id');a('.maxweight-edit').attr('id',x)}var u='it',v=a(this).parent().parent().prev().prev().attr('title');'Enlazar a la actividad Tarea'==v&&(a('#nombre_editar').hide(),a('#label_nombre').hide())}a('#nombre_editar').val(v),c(r,s,u),a('#edit').modal({backdrop:!1}),a('.fondo').show()}),a(document).on('click','#save_edit',function(){var p=a(this).attr('name'),q=a('#nombre_editar').val(),r=a('#peso_editar').val(),s=parseFloat(a('.maxweight-edit').attr('id'))+parseFloat(n),t=a('#calific').val(),u=a('#padre').val();if('-'==r&&(r=0),'99'==t)return void swal({title:'Tipo de Calificacion no valida.',text:'No es posible editar una categoria con un tipo de calificacion diferente a Promedio Simple, Promedio Ponderado, o Calificacion mas alta.\n Por favor seleccione uno de estos tipos de calificacion',html:!0,type:'warning',confirmButtonColor:'#d51b23'});if(r>s)return void swal({title:'Peso no valido.',text:'El peso ingresado supera el peso m\xE1ximo posible de la categoria padre que es: '+s+'% \n Para crear un nuevo elemento primero configure los pesos de los demas.',html:!0,type:'warning',confirmButtonColor:'#d51b23'});if(''==q)return void swal({title:'Ingrese el nuevo nombre del elemento',html:!0,type:'warning',confirmButtonColor:'#d51b23'});var v=a('#titulo').text();if('\xCDtem'==v.split(' ')[1]){var w='it';t=!1}else w='cat';var x=f();a.ajax({type:'POST',data:{course:x,element:p,type_e:w,newNombre:q,newPeso:r,newCalific:t,type:'editElement',parent:u},url:'managers/ajax_processing.php',success:function success(y){y.error?swal('Error',y.error,'error'):(swal({title:'Listo',text:y.msg,type:'success',showCancelButton:!1,showConfirmButton:!1,timer:1300}),a('#edit').modal('hide'),a('.fondo').hide(),g(x),console.log(y))},dataType:'json',cache:'false',error:function error(y){swal('Server Error',y.error,'error'),console.log('AJAXerror'),console.log(y)}})}),a(document).on('click','.delete',function(){var p=a(this).parent().parent().parent().attr('id').split('_'),q=f(),r=a(this).attr('data-name'),s=p[1],t=p[0];if('cat'===t)var u='la categoria: '+r;else var u='el item: '+r;swal({title:'Esta seguro que desea eliminar '+u+'?',text:'Tenga en cuenta que NO SE PODRAN RECUPERAR ninguna de la notas que haya registrado en este elemento una vez borrado!',type:'warning',showCancelButton:!0,confirmButtonClass:'btn-danger',confirmButtonText:'Aceptar, Borrar '+u,cancelButtonText:'Cancelar',closeOnConfirm:!1,closeOnCancel:!1},function(w){w?d(s,q,t):swal({title:'Cancelado',type:'error',showCancelButton:!1,showConfirmButton:!1,timer:1200})})}),a(document).on('click','.new',function(){if(o=a(this).parent().parent().children().next('.maxweight').attr('id'),0>=o)return void swal({title:'No se pueden crear mas categor\xEDas o \xEDtems en la categoria seleccionada.',text:'\n\r El peso de los elementos dentro de \xE9sta suma 100%.\n\r Para crear un nuevo elemento primero configure los pesos de los demas.',html:!0,type:'warning',confirmButtonColor:'#d51b23'});a('.new').prop('disabled',!0),a('.delete').prop('disabled',!0),a('.edit').prop('disabled',!0);var p=a('<div class = \'divForm\' style= \'display:none\'>');p.load('templates/categories_form.html'),p.toggle('slow','swing');var q=a(this).parent().parent();q.append('<hr style = "margin: 6px 0;border-top: 1px solid #ddd">'),q.append(p),window.setTimeout(function(){var r=q.attr('id');10==r&&(a('#divPeso').show(),a('#inputValor').on('blur',function(){var s=a(this).val(),t=parseInt(a(this).parent().parent().parent().parent().children().next('.maxweight').attr('id'));(0>s||s>t)&&(swal({title:'El valor debe estar entre 0 y el peso m\xE1ximo: '+t,text:'\n\rUsted ingres\xF3: '+s,html:!0,type:'warning',confirmButtonColor:'#d51b23'}),a(this).val(''))}),a('#inputValor').on('keypress',function(s){var t=document.all?s.keyCode:s.which;if(8==t||46==t)return!0;var u=/[0-9]/,v=String.fromCharCode(t);return u.test(v)})),a('#tipoItem').on('change',function(){var s=a(this).prop('selectedIndex');1==s?a('#divTipeC').show():a('#divTipeC').hide()}),a('#save').on('click',function(){var s=a(this).parent().parent().parent().parent().attr('id'),t=a(this).parent().parent().parent().parent().parent().attr('id');t=t.split('_')[1],h(s,t)}),a('#cancel').on('click',function(){var s=f();g(s)})},400)})}}});
